(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))c(u);new MutationObserver(u=>{for(const s of u)if(s.type==="childList")for(const v of s.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&c(v)}).observe(document,{childList:!0,subtree:!0});function n(u){const s={};return u.integrity&&(s.integrity=u.integrity),u.referrerPolicy&&(s.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?s.credentials="include":u.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(u){if(u.ep)return;u.ep=!0;const s=n(u);fetch(u.href,s)}})();class xe{grid=Array(16).fill(null);score=0;bestScore=0;playerName="Player";tileCounter=0;celebratedTiles=new Set;constructor(){this.loadScores()}loadScores(){const a=localStorage.getItem("2048-best-score");if(a){const n=JSON.parse(a);this.bestScore=n.score,this.playerName=n.name}}saveScores(){localStorage.setItem("2048-best-score",JSON.stringify({score:this.bestScore,name:this.playerName}))}saveState(){localStorage.setItem("2048-game-state",JSON.stringify({grid:this.grid,score:this.score,tileCounter:this.tileCounter,celebratedTiles:Array.from(this.celebratedTiles),isOver:this.isGameOver()}))}loadState(){const a=localStorage.getItem("2048-game-state");if(a){const n=JSON.parse(a);return n.isOver?(localStorage.removeItem("2048-game-state"),!1):(this.grid=n.grid,this.score=n.score,this.tileCounter=n.tileCounter,this.celebratedTiles=new Set(n.celebratedTiles||[]),!0)}return!1}init(a=!0){if(a&&this.loadState()){this.isGameOver()&&this.reset();return}this.reset()}reset(){this.grid=Array(16).fill(null),this.score=0,this.celebratedTiles=new Set,this.addTile(),this.addTile(),this.saveState()}addTile(){const a=this.grid.map((n,c)=>n===null?c:null).filter(n=>n!==null);if(a.length>0){const n=a[Math.floor(Math.random()*a.length)],c=Math.max(...this.grid.map(s=>s?s.value:0));let u=2;if(c>=16){const s=Math.log2(c)-2,v=[];for(let y=1;y<=s;y++){const S=Math.floor(200/Math.pow(2,y));for(let t=0;t<S;t++)v.push(y)}const P=v[Math.floor(Math.random()*v.length)];u=Math.pow(2,P)}else u=Math.random()<.9?2:4;this.grid[n]={value:u,id:this.tileCounter++,isNew:!0,isMerged:!1}}}isGameOver(){if(this.grid.some(n=>n===null))return!1;const a=4;for(let n=0;n<a;n++)for(let c=0;c<a;c++){const u=this.grid[n*a+c].value;if(c<a-1&&u===this.grid[n*a+c+1].value||n<a-1&&u===this.grid[(n+1)*a+c].value)return!1}return!0}move(a){let n=!1;const c=4;let u=Array(16).fill(null);const s=(v,P)=>v*c+P;if(a==="left"||a==="right")for(let v=0;v<c;v++){let P=[];for(let t=0;t<c;t++)P.push(this.grid[s(v,t)]);a==="right"&&P.reverse();let y=P.filter(t=>t!==null),S=[];for(let t=0;t<y.length;t++)if(t<y.length-1&&y[t].value===y[t+1].value){const M=y[t].value*2;S.push({value:M,id:y[t].id,isNew:!1,isMerged:!0}),this.score+=M,t++,n=!0}else y[t].isNew=!1,y[t].isMerged=!1,S.push(y[t]);for(;S.length<c;)S.push(null);a==="right"&&S.reverse();for(let t=0;t<c;t++)this.grid[s(v,t)]?.id!==S[t]?.id&&(n=!0),u[s(v,t)]=S[t]}else for(let v=0;v<c;v++){let P=[];for(let t=0;t<c;t++)P.push(this.grid[s(t,v)]);a==="down"&&P.reverse();let y=P.filter(t=>t!==null),S=[];for(let t=0;t<y.length;t++)if(t<y.length-1&&y[t].value===y[t+1].value){const M=y[t].value*2;S.push({value:M,id:y[t].id,isNew:!1,isMerged:!0}),this.score+=M,t++,n=!0}else y[t].isNew=!1,y[t].isMerged=!1,S.push(y[t]);for(;S.length<c;)S.push(null);a==="down"&&S.reverse();for(let t=0;t<c;t++)this.grid[s(t,v)]?.id!==S[t]?.id&&(n=!0),u[s(t,v)]=S[t]}return n&&(this.grid=u,this.addTile(),this.score>this.bestScore&&(this.bestScore=this.score,this.saveScores()),this.saveState()),n}getGrid(){return this.grid}getScore(){return this.score}getBestScore(){return this.bestScore}getPlayerName(){return this.playerName}getCelebratedTiles(){return this.celebratedTiles}setPlayerName(a){this.playerName=a,this.saveScores()}}var U={};(function f(a,n,c,u){var s=!!(a.Worker&&a.Blob&&a.Promise&&a.OffscreenCanvas&&a.OffscreenCanvasRenderingContext2D&&a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype.transferControlToOffscreen&&a.URL&&a.URL.createObjectURL),v=typeof Path2D=="function"&&typeof DOMMatrix=="function",P=(function(){if(!a.OffscreenCanvas)return!1;try{var r=new OffscreenCanvas(1,1),e=r.getContext("2d");e.fillRect(0,0,1,1);var i=r.transferToImageBitmap();e.createPattern(i,"no-repeat")}catch{return!1}return!0})();function y(){}function S(r){var e=n.exports.Promise,i=e!==void 0?e:a.Promise;return typeof i=="function"?new i(r):(r(y,y),null)}var t=(function(r,e){return{transform:function(i){if(r)return i;if(e.has(i))return e.get(i);var l=new OffscreenCanvas(i.width,i.height),d=l.getContext("2d");return d.drawImage(i,0,0),e.set(i,l),l},clear:function(){e.clear()}}})(P,new Map),M=(function(){var r=Math.floor(16.666666666666668),e,i,l={},d=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(e=function(h){var m=Math.random();return l[m]=requestAnimationFrame(function o(g){d===g||d+r-1<g?(d=g,delete l[m],h()):l[m]=requestAnimationFrame(o)}),m},i=function(h){l[h]&&cancelAnimationFrame(l[h])}):(e=function(h){return setTimeout(h,r)},i=function(h){return clearTimeout(h)}),{frame:e,cancel:i}})(),Q=(function(){var r,e,i={};function l(d){function h(m,o){d.postMessage({options:m||{},callback:o})}d.init=function(o){var g=o.transferControlToOffscreen();d.postMessage({canvas:g},[g])},d.fire=function(o,g,w){if(e)return h(o,null),e;var C=Math.random().toString(36).slice(2);return e=S(function(b){function I(x){x.data.callback===C&&(delete i[C],d.removeEventListener("message",I),e=null,t.clear(),w(),b())}d.addEventListener("message",I),h(o,C),i[C]=I.bind(null,{data:{callback:C}})}),e},d.reset=function(){d.postMessage({reset:!0});for(var o in i)i[o](),delete i[o]}}return function(){if(r)return r;if(!c&&s){var d=["var CONFETTI, SIZE = {}, module = {};","("+f.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{r=new Worker(URL.createObjectURL(new Blob([d])))}catch(h){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("ðŸŽŠ Could not load worker",h),null}l(r)}return r}})(),ee={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function re(r,e){return e?e(r):r}function te(r){return r!=null}function T(r,e,i){return re(r&&te(r[e])?r[e]:ee[e],i)}function ae(r){return r<0?0:Math.floor(r)}function ne(r,e){return Math.floor(Math.random()*(e-r))+r}function G(r){return parseInt(r,16)}function ie(r){return r.map(se)}function se(r){var e=String(r).replace(/[^0-9a-f]/gi,"");return e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),{r:G(e.substring(0,2)),g:G(e.substring(2,4)),b:G(e.substring(4,6))}}function oe(r){var e=T(r,"origin",Object);return e.x=T(e,"x",Number),e.y=T(e,"y",Number),e}function le(r){r.width=document.documentElement.clientWidth,r.height=document.documentElement.clientHeight}function ce(r){var e=r.getBoundingClientRect();r.width=e.width,r.height=e.height}function de(r){var e=document.createElement("canvas");return e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.pointerEvents="none",e.style.zIndex=r,e}function ue(r,e,i,l,d,h,m,o,g){r.save(),r.translate(e,i),r.rotate(h),r.scale(l,d),r.arc(0,0,1,m,o,g),r.restore()}function he(r){var e=r.angle*(Math.PI/180),i=r.spread*(Math.PI/180);return{x:r.x,y:r.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:r.startVelocity*.5+Math.random()*r.startVelocity,angle2D:-e+(.5*i-Math.random()*i),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:r.color,shape:r.shape,tick:0,totalTicks:r.ticks,decay:r.decay,drift:r.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:r.gravity*3,ovalScalar:.6,scalar:r.scalar,flat:r.flat}}function fe(r,e){e.x+=Math.cos(e.angle2D)*e.velocity+e.drift,e.y+=Math.sin(e.angle2D)*e.velocity+e.gravity,e.velocity*=e.decay,e.flat?(e.wobble=0,e.wobbleX=e.x+10*e.scalar,e.wobbleY=e.y+10*e.scalar,e.tiltSin=0,e.tiltCos=0,e.random=1):(e.wobble+=e.wobbleSpeed,e.wobbleX=e.x+10*e.scalar*Math.cos(e.wobble),e.wobbleY=e.y+10*e.scalar*Math.sin(e.wobble),e.tiltAngle+=.1,e.tiltSin=Math.sin(e.tiltAngle),e.tiltCos=Math.cos(e.tiltAngle),e.random=Math.random()+2);var i=e.tick++/e.totalTicks,l=e.x+e.random*e.tiltCos,d=e.y+e.random*e.tiltSin,h=e.wobbleX+e.random*e.tiltCos,m=e.wobbleY+e.random*e.tiltSin;if(r.fillStyle="rgba("+e.color.r+", "+e.color.g+", "+e.color.b+", "+(1-i)+")",r.beginPath(),v&&e.shape.type==="path"&&typeof e.shape.path=="string"&&Array.isArray(e.shape.matrix))r.fill(ge(e.shape.path,e.shape.matrix,e.x,e.y,Math.abs(h-l)*.1,Math.abs(m-d)*.1,Math.PI/10*e.wobble));else if(e.shape.type==="bitmap"){var o=Math.PI/10*e.wobble,g=Math.abs(h-l)*.1,w=Math.abs(m-d)*.1,C=e.shape.bitmap.width*e.scalar,b=e.shape.bitmap.height*e.scalar,I=new DOMMatrix([Math.cos(o)*g,Math.sin(o)*g,-Math.sin(o)*w,Math.cos(o)*w,e.x,e.y]);I.multiplySelf(new DOMMatrix(e.shape.matrix));var x=r.createPattern(t.transform(e.shape.bitmap),"no-repeat");x.setTransform(I),r.globalAlpha=1-i,r.fillStyle=x,r.fillRect(e.x-C/2,e.y-b/2,C,b),r.globalAlpha=1}else if(e.shape==="circle")r.ellipse?r.ellipse(e.x,e.y,Math.abs(h-l)*e.ovalScalar,Math.abs(m-d)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI):ue(r,e.x,e.y,Math.abs(h-l)*e.ovalScalar,Math.abs(m-d)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI);else if(e.shape==="star")for(var p=Math.PI/2*3,O=4*e.scalar,N=8*e.scalar,L=e.x,F=e.y,A=5,B=Math.PI/A;A--;)L=e.x+Math.cos(p)*N,F=e.y+Math.sin(p)*N,r.lineTo(L,F),p+=B,L=e.x+Math.cos(p)*O,F=e.y+Math.sin(p)*O,r.lineTo(L,F),p+=B;else r.moveTo(Math.floor(e.x),Math.floor(e.y)),r.lineTo(Math.floor(e.wobbleX),Math.floor(d)),r.lineTo(Math.floor(h),Math.floor(m)),r.lineTo(Math.floor(l),Math.floor(e.wobbleY));return r.closePath(),r.fill(),e.tick<e.totalTicks}function me(r,e,i,l,d){var h=e.slice(),m=r.getContext("2d"),o,g,w=S(function(C){function b(){o=g=null,m.clearRect(0,0,l.width,l.height),t.clear(),d(),C()}function I(){c&&!(l.width===u.width&&l.height===u.height)&&(l.width=r.width=u.width,l.height=r.height=u.height),!l.width&&!l.height&&(i(r),l.width=r.width,l.height=r.height),m.clearRect(0,0,l.width,l.height),h=h.filter(function(x){return fe(m,x)}),h.length?o=M.frame(I):b()}o=M.frame(I),g=b});return{addFettis:function(C){return h=h.concat(C),w},canvas:r,promise:w,reset:function(){o&&M.cancel(o),g&&g()}}}function V(r,e){var i=!r,l=!!T(e||{},"resize"),d=!1,h=T(e,"disableForReducedMotion",Boolean),m=s&&!!T(e||{},"useWorker"),o=m?Q():null,g=i?le:ce,w=r&&o?!!r.__confetti_initialized:!1,C=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,b;function I(p,O,N){for(var L=T(p,"particleCount",ae),F=T(p,"angle",Number),A=T(p,"spread",Number),B=T(p,"startVelocity",Number),ye=T(p,"decay",Number),Me=T(p,"gravity",Number),we=T(p,"drift",Number),Z=T(p,"colors",ie),be=T(p,"ticks",Number),_=T(p,"shapes"),Se=T(p,"scalar"),Ce=!!T(p,"flat"),H=oe(p),J=L,$=[],Ie=r.width*H.x,Te=r.height*H.y;J--;)$.push(he({x:Ie,y:Te,angle:F,spread:A,startVelocity:B,color:Z[J%Z.length],shape:_[ne(0,_.length)],ticks:be,decay:ye,gravity:Me,drift:we,scalar:Se,flat:Ce}));return b?b.addFettis($):(b=me(r,$,g,O,N),b.promise)}function x(p){var O=h||T(p,"disableForReducedMotion",Boolean),N=T(p,"zIndex",Number);if(O&&C)return S(function(B){B()});i&&b?r=b.canvas:i&&!r&&(r=de(N),document.body.appendChild(r)),l&&!w&&g(r);var L={width:r.width,height:r.height};o&&!w&&o.init(r),w=!0,o&&(r.__confetti_initialized=!0);function F(){if(o){var B={getBoundingClientRect:function(){if(!i)return r.getBoundingClientRect()}};g(B),o.postMessage({resize:{width:B.width,height:B.height}});return}L.width=L.height=null}function A(){b=null,l&&(d=!1,a.removeEventListener("resize",F)),i&&r&&(document.body.contains(r)&&document.body.removeChild(r),r=null,w=!1)}return l&&!d&&(d=!0,a.addEventListener("resize",F,!1)),o?o.fire(p,L,A):I(p,L,A)}return x.reset=function(){o&&o.reset(),b&&b.reset()},x}var W;function q(){return W||(W=V(null,{useWorker:!0,resize:!0})),W}function ge(r,e,i,l,d,h,m){var o=new Path2D(r),g=new Path2D;g.addPath(o,new DOMMatrix(e));var w=new Path2D;return w.addPath(g,new DOMMatrix([Math.cos(m)*d,Math.sin(m)*d,-Math.sin(m)*h,Math.cos(m)*h,i,l])),w}function ve(r){if(!v)throw new Error("path confetti are not supported in this browser");var e,i;typeof r=="string"?e=r:(e=r.path,i=r.matrix);var l=new Path2D(e),d=document.createElement("canvas"),h=d.getContext("2d");if(!i){for(var m=1e3,o=m,g=m,w=0,C=0,b,I,x=0;x<m;x+=2)for(var p=0;p<m;p+=2)h.isPointInPath(l,x,p,"nonzero")&&(o=Math.min(o,x),g=Math.min(g,p),w=Math.max(w,x),C=Math.max(C,p));b=w-o,I=C-g;var O=10,N=Math.min(O/b,O/I);i=[N,0,0,N,-Math.round(b/2+o)*N,-Math.round(I/2+g)*N]}return{type:"path",path:e,matrix:i}}function pe(r){var e,i=1,l="#000000",d='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof r=="string"?e=r:(e=r.text,i="scalar"in r?r.scalar:i,d="fontFamily"in r?r.fontFamily:d,l="color"in r?r.color:l);var h=10*i,m=""+h+"px "+d,o=new OffscreenCanvas(h,h),g=o.getContext("2d");g.font=m;var w=g.measureText(e),C=Math.ceil(w.actualBoundingBoxRight+w.actualBoundingBoxLeft),b=Math.ceil(w.actualBoundingBoxAscent+w.actualBoundingBoxDescent),I=2,x=w.actualBoundingBoxLeft+I,p=w.actualBoundingBoxAscent+I;C+=I+I,b+=I+I,o=new OffscreenCanvas(C,b),g=o.getContext("2d"),g.font=m,g.fillStyle=l,g.fillText(e,x,p);var O=1/i;return{type:"bitmap",bitmap:o.transferToImageBitmap(),matrix:[O,0,0,O,-C*O/2,-b*O/2]}}n.exports=function(){return q().apply(this,arguments)},n.exports.reset=function(){q().reset()},n.exports.create=V,n.exports.shapeFromPath=ve,n.exports.shapeFromText=pe})((function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}})(),U,!1);const X=U.exports;U.exports.create;const j=document.getElementById("grid"),Ee=document.getElementById("score"),Pe=document.getElementById("best"),Oe=document.getElementById("best-name"),Y=document.getElementById("game-over-modal"),Ne=document.getElementById("final-score"),E=new xe;function z(){const f=j.clientWidth,a=f*.0375,n=(f-a*5)/4,c=n+a,u=new Set(E.getGrid().filter(s=>s!==null).map(s=>s.id));j.querySelectorAll(".tile").forEach(s=>{const v=parseInt(s.id.split("-")[1]);u.has(v)||s.remove()}),E.getGrid().forEach((s,v)=>{if(!s)return;const P=Math.floor(v/4),y=v%4,S=a+P*c,t=a+y*c;let M=document.getElementById(`tile-${s.id}`);M||(M=document.createElement("div"),M.id=`tile-${s.id}`,M.classList.add("tile"),M.style.transition="none",M.style.width=`${n}px`,M.style.height=`${n}px`,M.style.transform=`translate(${t}px, ${S}px)`,j.appendChild(M),M.offsetHeight,M.style.transition=""),M.innerText=s.value.toString(),M.className=`tile tile-${s.value}`,s.isNew&&M.classList.add("tile-new"),s.isMerged&&M.classList.add("tile-merged"),M.style.width=`${n}px`,M.style.height=`${n}px`,M.style.transform=`translate(${t}px, ${S}px)`}),Ee.innerText=E.getScore().toString(),Pe.innerText=E.getBestScore().toString(),Oe.innerText=E.getPlayerName(),E.isGameOver()?(Ne.innerText=E.getScore().toString(),Y.classList.remove("hidden")):Y.classList.add("hidden")}function R(f){E.isGameOver()||E.move(f)&&(z(),Le())}function Le(){const f=[1024,2048,4096,8192],a=E.getGrid(),n=E.getCelebratedTiles();for(const c of a)if(c&&f.includes(c.value)&&!n.has(c.value)){n.add(c.value),E.saveState(),Be();break}}function Be(){const a=Date.now()+3e3,n={startVelocity:30,spread:360,ticks:60,zIndex:0};function c(s,v){return Math.random()*(v-s)+s}const u=setInterval(function(){const s=a-Date.now();if(s<=0)return clearInterval(u);const v=50*(s/3e3);X({...n,particleCount:v,origin:{x:c(.1,.3),y:Math.random()-.2}}),X({...n,particleCount:v,origin:{x:c(.7,.9),y:Math.random()-.2}})},250)}window.resetGame=()=>{const f=prompt("Enter your name for high scores:",E.getPlayerName());f&&E.setPlayerName(f),E.init(!1),z()};document.addEventListener("keydown",f=>{f.key==="ArrowLeft"&&R("left"),f.key==="ArrowRight"&&R("right"),f.key==="ArrowUp"&&R("up"),f.key==="ArrowDown"&&R("down"),(f.metaKey||f.ctrlKey)&&f.key==="n"&&(f.preventDefault(),window.resetGame())});let k,D;const K=(f,a)=>{if(k===null||D===null)return;const n=f-k,c=a-D,u=30;Math.abs(n)>Math.abs(c)?Math.abs(n)>u&&R(n>0?"right":"left"):Math.abs(c)>u&&R(c>0?"down":"up"),k=D=null};document.addEventListener("touchstart",f=>{k=f.touches[0].clientX,D=f.touches[0].clientY},{passive:!0});document.addEventListener("touchend",f=>K(f.changedTouches[0].clientX,f.changedTouches[0].clientY),{passive:!0});document.addEventListener("mousedown",f=>{k=f.clientX,D=f.clientY});document.addEventListener("mouseup",f=>K(f.clientX,f.clientY));window.addEventListener("resize",z);E.init();z();
