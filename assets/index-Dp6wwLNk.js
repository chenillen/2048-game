(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))d(u);new MutationObserver(u=>{for(const n of u)if(n.type==="childList")for(const S of n.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&d(S)}).observe(document,{childList:!0,subtree:!0});function a(u){const n={};return u.integrity&&(n.integrity=u.integrity),u.referrerPolicy&&(n.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?n.credentials="include":u.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function d(u){if(u.ep)return;u.ep=!0;const n=a(u);fetch(u.href,n)}})();class Ue{grid=Array(16).fill(null);score=0;bestScore=0;playerName="Player";tileCounter=0;celebratedTiles=new Set;difficulty="easy";history=[];constructor(){this.loadScores()}loadScores(){const r=localStorage.getItem("2048-best-score");if(r){const a=JSON.parse(r);this.bestScore=a.score,this.playerName=a.name}}saveScores(){localStorage.setItem("2048-best-score",JSON.stringify({score:this.bestScore,name:this.playerName}))}saveState(){const r=JSON.stringify({grid:this.grid,score:this.score,tileCounter:this.tileCounter,celebratedTiles:Array.from(this.celebratedTiles),isOver:this.isGameOver(),difficulty:this.difficulty});localStorage.setItem("2048-game-state",r)}loadState(){const r=localStorage.getItem("2048-game-state");if(r){const a=JSON.parse(r);return a.isOver?(localStorage.removeItem("2048-game-state"),!1):(this.grid=a.grid,this.score=a.score,this.tileCounter=a.tileCounter,this.celebratedTiles=new Set(a.celebratedTiles||[]),this.difficulty=a.difficulty||"easy",!0)}return!1}init(r=!0,a){r&&this.loadState()||(a&&(this.difficulty=a),this.reset())}reset(){this.grid=Array(16).fill(null),this.score=0,this.celebratedTiles=new Set,this.history=[],this.addTile(),this.addTile(),this.saveState()}addTile(){const r=this.grid.map((a,d)=>a===null?d:null).filter(a=>a!==null);if(r.length>0){const a=r[Math.floor(Math.random()*r.length)],d=Math.max(...this.grid.map(n=>n?n.value:0));let u=2;if(this.difficulty==="easy"){const n=[2,4,8];d>=128&&n.push(16),u=n[Math.floor(Math.random()*n.length)]}else if(d>=16){const n=Math.log2(d)-2,S=[];for(let w=1;w<=n;w++){const I=Math.max(1,Math.floor(200/Math.pow(2,w)));for(let y=0;y<I;y++)S.push(w)}const P=S[Math.floor(Math.random()*S.length)];u=Math.pow(2,P)}else u=Math.random()<.9?2:4;this.grid[a]={value:u,id:this.tileCounter++,isNew:!0,isMerged:!1}}}undo(){if(this.history.length===0)return!1;const r=this.history.pop(),a=JSON.parse(r);return this.grid=a.grid,this.score=a.score,this.tileCounter=a.tileCounter,this.celebratedTiles=new Set(a.celebratedTiles),this.saveState(),!0}isGameOver(){if(this.grid.some(a=>a===null))return!1;const r=4;for(let a=0;a<r;a++)for(let d=0;d<r;d++){const u=this.grid[a*r+d].value;if(d<r-1&&u===this.grid[a*r+d+1].value||a<r-1&&u===this.grid[(a+1)*r+d].value)return!1}return!0}move(r){const a=JSON.stringify({grid:this.grid.map(w=>w?{...w}:null),score:this.score,tileCounter:this.tileCounter,celebratedTiles:Array.from(this.celebratedTiles)});let d=!1,u=!1;const n=4;let S=Array(16).fill(null);const P=(w,I)=>w*n+I;if(r==="left"||r==="right")for(let w=0;w<n;w++){let I=[];for(let i=0;i<n;i++)I.push(this.grid[P(w,i)]);r==="right"&&I.reverse();let y=I.filter(i=>i!==null),v=[];for(let i=0;i<y.length;i++)if(i<y.length-1&&y[i].value===y[i+1].value){const B=y[i].value*2;v.push({value:B,id:y[i].id,isNew:!1,isMerged:!0}),this.score+=B,i++,d=!0,u=!0}else y[i].isNew=!1,y[i].isMerged=!1,v.push(y[i]);for(;v.length<n;)v.push(null);r==="right"&&v.reverse();for(let i=0;i<n;i++)this.grid[P(w,i)]?.id!==v[i]?.id&&(d=!0),S[P(w,i)]=v[i]}else for(let w=0;w<n;w++){let I=[];for(let i=0;i<n;i++)I.push(this.grid[P(i,w)]);r==="down"&&I.reverse();let y=I.filter(i=>i!==null),v=[];for(let i=0;i<y.length;i++)if(i<y.length-1&&y[i].value===y[i+1].value){const B=y[i].value*2;v.push({value:B,id:y[i].id,isNew:!1,isMerged:!0}),this.score+=B,i++,d=!0,u=!0}else y[i].isNew=!1,y[i].isMerged=!1,v.push(y[i]);for(;v.length<n;)v.push(null);r==="down"&&v.reverse();for(let i=0;i<n;i++)this.grid[P(i,w)]?.id!==v[i]?.id&&(d=!0),S[P(i,w)]=v[i]}return d&&(this.history.push(a),this.history.length>20&&this.history.shift(),this.grid=S,this.addTile(),this.score>this.bestScore&&(this.bestScore=this.score,this.saveScores()),this.saveState()),{moved:d,merged:u}}getGrid(){return this.grid}getScore(){return this.score}getBestScore(){return this.bestScore}getPlayerName(){return this.playerName}getCelebratedTiles(){return this.celebratedTiles}getDifficulty(){return this.difficulty}canUndo(){return this.history.length>0}setPlayerName(r){this.playerName=r,this.saveScores()}}var K={};(function l(r,a,d,u){var n=!!(r.Worker&&r.Blob&&r.Promise&&r.OffscreenCanvas&&r.OffscreenCanvasRenderingContext2D&&r.HTMLCanvasElement&&r.HTMLCanvasElement.prototype.transferControlToOffscreen&&r.URL&&r.URL.createObjectURL),S=typeof Path2D=="function"&&typeof DOMMatrix=="function",P=(function(){if(!r.OffscreenCanvas)return!1;try{var t=new OffscreenCanvas(1,1),e=t.getContext("2d");e.fillRect(0,0,1,1);var s=t.transferToImageBitmap();e.createPattern(s,"no-repeat")}catch{return!1}return!0})();function w(){}function I(t){var e=a.exports.Promise,s=e!==void 0?e:r.Promise;return typeof s=="function"?new s(t):(t(w,w),null)}var y=(function(t,e){return{transform:function(s){if(t)return s;if(e.has(s))return e.get(s);var c=new OffscreenCanvas(s.width,s.height),h=c.getContext("2d");return h.drawImage(s,0,0),e.set(s,c),c},clear:function(){e.clear()}}})(P,new Map),v=(function(){var t=Math.floor(16.666666666666668),e,s,c={},h=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(e=function(f){var m=Math.random();return c[m]=requestAnimationFrame(function o(g){h===g||h+t-1<g?(h=g,delete c[m],f()):c[m]=requestAnimationFrame(o)}),m},s=function(f){c[f]&&cancelAnimationFrame(c[f])}):(e=function(f){return setTimeout(f,t)},s=function(f){return clearTimeout(f)}),{frame:e,cancel:s}})(),i=(function(){var t,e,s={};function c(h){function f(m,o){h.postMessage({options:m||{},callback:o})}h.init=function(o){var g=o.transferControlToOffscreen();h.postMessage({canvas:g},[g])},h.fire=function(o,g,M){if(e)return f(o,null),e;var x=Math.random().toString(36).slice(2);return e=I(function(b){function T(L){L.data.callback===x&&(delete s[x],h.removeEventListener("message",T),e=null,y.clear(),M(),b())}h.addEventListener("message",T),f(o,x),s[x]=T.bind(null,{data:{callback:x}})}),e},h.reset=function(){h.postMessage({reset:!0});for(var o in s)s[o](),delete s[o]}}return function(){if(t)return t;if(!d&&n){var h=["var CONFETTI, SIZE = {}, module = {};","("+l.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{t=new Worker(URL.createObjectURL(new Blob([h])))}catch(f){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("ðŸŽŠ Could not load worker",f),null}c(t)}return t}})(),B={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function $(t,e){return e?e(t):t}function ge(t){return t!=null}function C(t,e,s){return $(t&&ge(t[e])?t[e]:B[e],s)}function ve(t){return t<0?0:Math.floor(t)}function pe(t,e){return Math.floor(Math.random()*(e-t))+t}function q(t){return parseInt(t,16)}function ye(t){return t.map(we)}function we(t){var e=String(t).replace(/[^0-9a-f]/gi,"");return e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),{r:q(e.substring(0,2)),g:q(e.substring(2,4)),b:q(e.substring(4,6))}}function Me(t){var e=C(t,"origin",Object);return e.x=C(e,"x",Number),e.y=C(e,"y",Number),e}function be(t){t.width=document.documentElement.clientWidth,t.height=document.documentElement.clientHeight}function Se(t){var e=t.getBoundingClientRect();t.width=e.width,t.height=e.height}function xe(t){var e=document.createElement("canvas");return e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.pointerEvents="none",e.style.zIndex=t,e}function Te(t,e,s,c,h,f,m,o,g){t.save(),t.translate(e,s),t.rotate(f),t.scale(c,h),t.arc(0,0,1,m,o,g),t.restore()}function Ce(t){var e=t.angle*(Math.PI/180),s=t.spread*(Math.PI/180);return{x:t.x,y:t.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:t.startVelocity*.5+Math.random()*t.startVelocity,angle2D:-e+(.5*s-Math.random()*s),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:t.color,shape:t.shape,tick:0,totalTicks:t.ticks,decay:t.decay,drift:t.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:t.gravity*3,ovalScalar:.6,scalar:t.scalar,flat:t.flat}}function Ie(t,e){e.x+=Math.cos(e.angle2D)*e.velocity+e.drift,e.y+=Math.sin(e.angle2D)*e.velocity+e.gravity,e.velocity*=e.decay,e.flat?(e.wobble=0,e.wobbleX=e.x+10*e.scalar,e.wobbleY=e.y+10*e.scalar,e.tiltSin=0,e.tiltCos=0,e.random=1):(e.wobble+=e.wobbleSpeed,e.wobbleX=e.x+10*e.scalar*Math.cos(e.wobble),e.wobbleY=e.y+10*e.scalar*Math.sin(e.wobble),e.tiltAngle+=.1,e.tiltSin=Math.sin(e.tiltAngle),e.tiltCos=Math.cos(e.tiltAngle),e.random=Math.random()+2);var s=e.tick++/e.totalTicks,c=e.x+e.random*e.tiltCos,h=e.y+e.random*e.tiltSin,f=e.wobbleX+e.random*e.tiltCos,m=e.wobbleY+e.random*e.tiltSin;if(t.fillStyle="rgba("+e.color.r+", "+e.color.g+", "+e.color.b+", "+(1-s)+")",t.beginPath(),S&&e.shape.type==="path"&&typeof e.shape.path=="string"&&Array.isArray(e.shape.matrix))t.fill(Le(e.shape.path,e.shape.matrix,e.x,e.y,Math.abs(f-c)*.1,Math.abs(m-h)*.1,Math.PI/10*e.wobble));else if(e.shape.type==="bitmap"){var o=Math.PI/10*e.wobble,g=Math.abs(f-c)*.1,M=Math.abs(m-h)*.1,x=e.shape.bitmap.width*e.scalar,b=e.shape.bitmap.height*e.scalar,T=new DOMMatrix([Math.cos(o)*g,Math.sin(o)*g,-Math.sin(o)*M,Math.cos(o)*M,e.x,e.y]);T.multiplySelf(new DOMMatrix(e.shape.matrix));var L=t.createPattern(y.transform(e.shape.bitmap),"no-repeat");L.setTransform(T),t.globalAlpha=1-s,t.fillStyle=L,t.fillRect(e.x-x/2,e.y-b/2,x,b),t.globalAlpha=1}else if(e.shape==="circle")t.ellipse?t.ellipse(e.x,e.y,Math.abs(f-c)*e.ovalScalar,Math.abs(m-h)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI):Te(t,e.x,e.y,Math.abs(f-c)*e.ovalScalar,Math.abs(m-h)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI);else if(e.shape==="star")for(var p=Math.PI/2*3,O=4*e.scalar,k=8*e.scalar,N=e.x,F=e.y,U=5,A=Math.PI/U;U--;)N=e.x+Math.cos(p)*k,F=e.y+Math.sin(p)*k,t.lineTo(N,F),p+=A,N=e.x+Math.cos(p)*O,F=e.y+Math.sin(p)*O,t.lineTo(N,F),p+=A;else t.moveTo(Math.floor(e.x),Math.floor(e.y)),t.lineTo(Math.floor(e.wobbleX),Math.floor(h)),t.lineTo(Math.floor(f),Math.floor(m)),t.lineTo(Math.floor(c),Math.floor(e.wobbleY));return t.closePath(),t.fill(),e.tick<e.totalTicks}function Ee(t,e,s,c,h){var f=e.slice(),m=t.getContext("2d"),o,g,M=I(function(x){function b(){o=g=null,m.clearRect(0,0,c.width,c.height),y.clear(),h(),x()}function T(){d&&!(c.width===u.width&&c.height===u.height)&&(c.width=t.width=u.width,c.height=t.height=u.height),!c.width&&!c.height&&(s(t),c.width=t.width,c.height=t.height),m.clearRect(0,0,c.width,c.height),f=f.filter(function(L){return Ie(m,L)}),f.length?o=v.frame(T):b()}o=v.frame(T),g=b});return{addFettis:function(x){return f=f.concat(x),M},canvas:t,promise:M,reset:function(){o&&v.cancel(o),g&&g()}}}function re(t,e){var s=!t,c=!!C(e||{},"resize"),h=!1,f=C(e,"disableForReducedMotion",Boolean),m=n&&!!C(e||{},"useWorker"),o=m?i():null,g=s?be:Se,M=t&&o?!!t.__confetti_initialized:!1,x=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,b;function T(p,O,k){for(var N=C(p,"particleCount",ve),F=C(p,"angle",Number),U=C(p,"spread",Number),A=C(p,"startVelocity",Number),ke=C(p,"decay",Number),Ne=C(p,"gravity",Number),Be=C(p,"drift",Number),ne=C(p,"colors",ye),Ae=C(p,"ticks",Number),ie=C(p,"shapes"),Fe=C(p,"scalar"),Re=!!C(p,"flat"),se=Me(p),oe=N,Z=[],De=t.width*se.x,ze=t.height*se.y;oe--;)Z.push(Ce({x:De,y:ze,angle:F,spread:U,startVelocity:A,color:ne[oe%ne.length],shape:ie[pe(0,ie.length)],ticks:Ae,decay:ke,gravity:Ne,drift:Be,scalar:Fe,flat:Re}));return b?b.addFettis(Z):(b=Ee(t,Z,g,O,k),b.promise)}function L(p){var O=f||C(p,"disableForReducedMotion",Boolean),k=C(p,"zIndex",Number);if(O&&x)return I(function(A){A()});s&&b?t=b.canvas:s&&!t&&(t=xe(k),document.body.appendChild(t)),c&&!M&&g(t);var N={width:t.width,height:t.height};o&&!M&&o.init(t),M=!0,o&&(t.__confetti_initialized=!0);function F(){if(o){var A={getBoundingClientRect:function(){if(!s)return t.getBoundingClientRect()}};g(A),o.postMessage({resize:{width:A.width,height:A.height}});return}N.width=N.height=null}function U(){b=null,c&&(h=!1,r.removeEventListener("resize",F)),s&&t&&(document.body.contains(t)&&document.body.removeChild(t),t=null,M=!1)}return c&&!h&&(h=!0,r.addEventListener("resize",F,!1)),o?o.fire(p,N,U):T(p,N,U)}return L.reset=function(){o&&o.reset(),b&&b.reset()},L}var J;function ae(){return J||(J=re(null,{useWorker:!0,resize:!0})),J}function Le(t,e,s,c,h,f,m){var o=new Path2D(t),g=new Path2D;g.addPath(o,new DOMMatrix(e));var M=new Path2D;return M.addPath(g,new DOMMatrix([Math.cos(m)*h,Math.sin(m)*h,-Math.sin(m)*f,Math.cos(m)*f,s,c])),M}function Oe(t){if(!S)throw new Error("path confetti are not supported in this browser");var e,s;typeof t=="string"?e=t:(e=t.path,s=t.matrix);var c=new Path2D(e),h=document.createElement("canvas"),f=h.getContext("2d");if(!s){for(var m=1e3,o=m,g=m,M=0,x=0,b,T,L=0;L<m;L+=2)for(var p=0;p<m;p+=2)f.isPointInPath(c,L,p,"nonzero")&&(o=Math.min(o,L),g=Math.min(g,p),M=Math.max(M,L),x=Math.max(x,p));b=M-o,T=x-g;var O=10,k=Math.min(O/b,O/T);s=[k,0,0,k,-Math.round(b/2+o)*k,-Math.round(T/2+g)*k]}return{type:"path",path:e,matrix:s}}function Pe(t){var e,s=1,c="#000000",h='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof t=="string"?e=t:(e=t.text,s="scalar"in t?t.scalar:s,h="fontFamily"in t?t.fontFamily:h,c="color"in t?t.color:c);var f=10*s,m=""+f+"px "+h,o=new OffscreenCanvas(f,f),g=o.getContext("2d");g.font=m;var M=g.measureText(e),x=Math.ceil(M.actualBoundingBoxRight+M.actualBoundingBoxLeft),b=Math.ceil(M.actualBoundingBoxAscent+M.actualBoundingBoxDescent),T=2,L=M.actualBoundingBoxLeft+T,p=M.actualBoundingBoxAscent+T;x+=T+T,b+=T+T,o=new OffscreenCanvas(x,b),g=o.getContext("2d"),g.font=m,g.fillStyle=c,g.fillText(e,L,p);var O=1/s;return{type:"bitmap",bitmap:o.transferToImageBitmap(),matrix:[O,0,0,O,-x*O/2,-b*O/2]}}a.exports=function(){return ae().apply(this,arguments)},a.exports.reset=function(){ae().reset()},a.exports.create=re,a.exports.shapeFromPath=Oe,a.exports.shapeFromText=Pe})((function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}})(),K,!1);const le=K.exports;K.exports.create;const X=document.getElementById("grid"),Ge=document.getElementById("score"),He=document.getElementById("best"),We=document.getElementById("best-name"),_=document.getElementById("game-over-modal"),je=document.getElementById("final-score"),Q=document.getElementById("name-modal"),j=document.getElementById("player-name-input"),ue=document.getElementById("start-game-btn"),Y=document.getElementById("music-toggle"),ee=document.getElementById("undo-btn"),ce=document.querySelectorAll(".diff-option"),E=new Ue;let he="easy";const R={move:new Audio("https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"),merge:new Audio("https://assets.mixkit.co/active_storage/sfx/2016/2016-preview.mp3"),celebrate:new Audio("https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"),click:new Audio("https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3")},de=["https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3"],D=new Audio;D.loop=!1;let z=!1;function te(){if(!z)return;const l=de[Math.floor(Math.random()*de.length)];D.src=l,D.play().catch(()=>{z=!1,fe()})}D.onended=()=>te();function fe(){Y.innerText=z?"ðŸŽµ On":"ðŸŽµ Off",Y.classList.toggle("off",!z)}Y.addEventListener("click",()=>{z=!z,z?D.src?D.play():te():D.pause(),fe()});ce.forEach(l=>{l.addEventListener("click",()=>{R.click.play(),ce.forEach(r=>r.classList.remove("active")),l.classList.add("active"),he=l.getAttribute("data-value")})});function V(){const l=X.clientWidth,r=l*.0375,a=(l-r*5)/4,d=a+r,u=new Set(E.getGrid().filter(n=>n!==null).map(n=>n.id));X.querySelectorAll(".tile").forEach(n=>{const S=parseInt(n.id.split("-")[1]);u.has(S)||n.remove()}),E.getGrid().forEach((n,S)=>{if(!n)return;const P=Math.floor(S/4),w=S%4,I=r+P*d,y=r+w*d;let v=document.getElementById(`tile-${n.id}`);if(!v){v=document.createElement("div"),v.id=`tile-${n.id}`,v.classList.add("tile");const $=document.createElement("div");$.classList.add("tile-inner"),v.appendChild($),v.style.width=`${a}px`,v.style.height=`${a}px`,v.style.transform=`translate(${y}px, ${I}px)`,X.appendChild(v)}const i=v.querySelector(".tile-inner");i.innerText=n.value.toString(),v.className=`tile tile-${n.value}`;const B=n.value.toString().length;B>=4&&v.classList.add(`tile-digits-${B}`),n.isNew&&v.classList.add("tile-new"),n.isMerged&&v.classList.add("tile-merged"),v.style.transform=`translate(${y}px, ${I}px)`}),Ge.innerText=E.getScore().toString(),He.innerText=E.getBestScore().toString(),We.innerText=E.getPlayerName(),ee.style.opacity=E.canUndo()?"1":"0.5",E.isGameOver()?(je.innerText=E.getScore().toString(),_.classList.remove("hidden")):_.classList.add("hidden")}function Ve(){return!_.classList.contains("hidden")||!Q.classList.contains("hidden")}function G(l){if(E.isGameOver()||Ve())return;const r=E.move(l);r.moved&&(r.merged?(R.merge.currentTime=0,R.merge.play()):(R.move.currentTime=0,R.move.play()),V(),$e())}function $e(){const l=[1024,2048,4096,8192],r=E.getGrid(),a=E.getCelebratedTiles();for(const d of r)if(d&&l.includes(d.value)&&!a.has(d.value)){a.add(d.value),E.saveState(),R.celebrate.play(),_e();break}}function _e(){const r=Date.now()+3e3,a={startVelocity:30,spread:360,ticks:60,zIndex:0},d=(n,S)=>Math.random()*(S-n)+n,u=setInterval(function(){const n=r-Date.now();if(n<=0)return clearInterval(u);const S=50*(n/3e3);le({...a,particleCount:S,origin:{x:d(.1,.3),y:Math.random()-.2}}),le({...a,particleCount:S,origin:{x:d(.7,.9),y:Math.random()-.2}})},250)}window.resetGame=()=>{R.click.play(),_.classList.add("hidden"),j.value=E.getPlayerName(),Q.classList.remove("hidden"),j.focus()};ue.addEventListener("click",()=>{R.click.play();const l=j.value.trim()||"Player";E.setPlayerName(l),Q.classList.add("hidden"),E.init(!1,he),z&&!D.src&&te(),V()});ee.addEventListener("click",()=>{E.undo()&&(R.click.play(),V())});j.addEventListener("keydown",l=>{l.key==="Enter"&&ue.click()});document.addEventListener("keydown",l=>{document.activeElement!==j&&(l.key==="ArrowLeft"&&G("left"),l.key==="ArrowRight"&&G("right"),l.key==="ArrowUp"&&G("up"),l.key==="ArrowDown"&&G("down"),l.altKey&&l.key.toLowerCase()==="n"&&(l.preventDefault(),window.resetGame()),l.altKey&&l.key.toLowerCase()==="z"&&(l.preventDefault(),ee.click()))});let H,W;const me=(l,r)=>{if(H===null||W===null)return;const a=l-H,d=r-W,u=30;Math.abs(a)>Math.abs(d)?Math.abs(a)>u&&G(a>0?"right":"left"):Math.abs(d)>u&&G(d>0?"down":"up"),H=W=null};document.addEventListener("touchstart",l=>{H=l.touches[0].clientX,W=l.touches[0].clientY},{passive:!0});document.addEventListener("touchend",l=>me(l.changedTouches[0].clientX,l.changedTouches[0].clientY),{passive:!0});document.addEventListener("mousedown",l=>{H=l.clientX,W=l.clientY});document.addEventListener("mouseup",l=>me(l.clientX,l.clientY));window.addEventListener("resize",V);E.init();V();
