(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))d(h);new MutationObserver(h=>{for(const n of h)if(n.type==="childList")for(const S of n.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&d(S)}).observe(document,{childList:!0,subtree:!0});function a(h){const n={};return h.integrity&&(n.integrity=h.integrity),h.referrerPolicy&&(n.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?n.credentials="include":h.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function d(h){if(h.ep)return;h.ep=!0;const n=a(h);fetch(h.href,n)}})();class Ge{grid=Array(16).fill(null);score=0;bestScore=0;playerName="Player";tileCounter=0;celebratedTiles=new Set;difficulty="easy";history=[];constructor(){this.loadScores()}loadScores(){const r=localStorage.getItem("2048-best-score");if(r){const a=JSON.parse(r);this.bestScore=a.score,this.playerName=a.name}}saveScores(){localStorage.setItem("2048-best-score",JSON.stringify({score:this.bestScore,name:this.playerName}))}saveState(){const r=JSON.stringify({grid:this.grid,score:this.score,tileCounter:this.tileCounter,celebratedTiles:Array.from(this.celebratedTiles),isOver:this.isGameOver(),difficulty:this.difficulty});localStorage.setItem("2048-game-state",r)}loadState(){const r=localStorage.getItem("2048-game-state");if(r){const a=JSON.parse(r);return a.isOver?(localStorage.removeItem("2048-game-state"),!1):(this.grid=a.grid,this.score=a.score,this.tileCounter=a.tileCounter,this.celebratedTiles=new Set(a.celebratedTiles||[]),this.difficulty=a.difficulty||"easy",!0)}return!1}init(r=!0,a){r&&this.loadState()||(a&&(this.difficulty=a),this.reset())}reset(){this.grid=Array(16).fill(null),this.score=0,this.celebratedTiles=new Set,this.history=[],this.addTile(),this.addTile(),this.saveState()}addTile(){const r=this.grid.map((a,d)=>a===null?d:null).filter(a=>a!==null);if(r.length>0){const a=r[Math.floor(Math.random()*r.length)],d=Math.max(...this.grid.map(n=>n?n.value:0));let h=2;if(this.difficulty==="easy"){const n=[2,4,8];d>=128&&n.push(16),h=n[Math.floor(Math.random()*n.length)]}else if(d>=16){const n=Math.log2(d)-2,S=[];for(let w=1;w<=n;w++){const C=Math.max(1,Math.floor(200/Math.pow(2,w)));for(let y=0;y<C;y++)S.push(w)}const P=S[Math.floor(Math.random()*S.length)];h=Math.pow(2,P)}else h=Math.random()<.9?2:4;this.grid[a]={value:h,id:this.tileCounter++,isNew:!0,isMerged:!1}}}undo(){if(this.history.length===0)return!1;const r=this.history.pop(),a=JSON.parse(r);return this.grid=a.grid,this.score=a.score,this.tileCounter=a.tileCounter,this.celebratedTiles=new Set(a.celebratedTiles),this.saveState(),!0}isGameOver(){if(this.grid.some(a=>a===null))return!1;const r=4;for(let a=0;a<r;a++)for(let d=0;d<r;d++){const h=this.grid[a*r+d].value;if(d<r-1&&h===this.grid[a*r+d+1].value||a<r-1&&h===this.grid[(a+1)*r+d].value)return!1}return!0}move(r){const a=JSON.stringify({grid:this.grid.map(w=>w?{...w}:null),score:this.score,tileCounter:this.tileCounter,celebratedTiles:Array.from(this.celebratedTiles)});let d=!1,h=!1;const n=4;let S=Array(16).fill(null);const P=(w,C)=>w*n+C;if(r==="left"||r==="right")for(let w=0;w<n;w++){let C=[];for(let i=0;i<n;i++)C.push(this.grid[P(w,i)]);r==="right"&&C.reverse();let y=C.filter(i=>i!==null),u=[];for(let i=0;i<y.length;i++)if(i<y.length-1&&y[i].value===y[i+1].value){const B=y[i].value*2;u.push({value:B,id:y[i].id,isNew:!1,isMerged:!0}),this.score+=B,i++,d=!0,h=!0}else y[i].isNew=!1,y[i].isMerged=!1,u.push(y[i]);for(;u.length<n;)u.push(null);r==="right"&&u.reverse();for(let i=0;i<n;i++)this.grid[P(w,i)]?.id!==u[i]?.id&&(d=!0),S[P(w,i)]=u[i]}else for(let w=0;w<n;w++){let C=[];for(let i=0;i<n;i++)C.push(this.grid[P(i,w)]);r==="down"&&C.reverse();let y=C.filter(i=>i!==null),u=[];for(let i=0;i<y.length;i++)if(i<y.length-1&&y[i].value===y[i+1].value){const B=y[i].value*2;u.push({value:B,id:y[i].id,isNew:!1,isMerged:!0}),this.score+=B,i++,d=!0,h=!0}else y[i].isNew=!1,y[i].isMerged=!1,u.push(y[i]);for(;u.length<n;)u.push(null);r==="down"&&u.reverse();for(let i=0;i<n;i++)this.grid[P(i,w)]?.id!==u[i]?.id&&(d=!0),S[P(i,w)]=u[i]}return d&&(this.history.push(a),this.history.length>20&&this.history.shift(),this.grid=S,this.addTile(),this.score>this.bestScore&&(this.bestScore=this.score,this.saveScores()),this.saveState()),{moved:d,merged:h}}getGrid(){return this.grid}getScore(){return this.score}getBestScore(){return this.bestScore}getPlayerName(){return this.playerName}getCelebratedTiles(){return this.celebratedTiles}getDifficulty(){return this.difficulty}canUndo(){return this.history.length>0}setPlayerName(r){this.playerName=r,this.saveScores()}}var Y={};(function o(r,a,d,h){var n=!!(r.Worker&&r.Blob&&r.Promise&&r.OffscreenCanvas&&r.OffscreenCanvasRenderingContext2D&&r.HTMLCanvasElement&&r.HTMLCanvasElement.prototype.transferControlToOffscreen&&r.URL&&r.URL.createObjectURL),S=typeof Path2D=="function"&&typeof DOMMatrix=="function",P=(function(){if(!r.OffscreenCanvas)return!1;try{var t=new OffscreenCanvas(1,1),e=t.getContext("2d");e.fillRect(0,0,1,1);var s=t.transferToImageBitmap();e.createPattern(s,"no-repeat")}catch{return!1}return!0})();function w(){}function C(t){var e=a.exports.Promise,s=e!==void 0?e:r.Promise;return typeof s=="function"?new s(t):(t(w,w),null)}var y=(function(t,e){return{transform:function(s){if(t)return s;if(e.has(s))return e.get(s);var c=new OffscreenCanvas(s.width,s.height),f=c.getContext("2d");return f.drawImage(s,0,0),e.set(s,c),c},clear:function(){e.clear()}}})(P,new Map),u=(function(){var t=Math.floor(16.666666666666668),e,s,c={},f=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(e=function(m){var g=Math.random();return c[g]=requestAnimationFrame(function l(v){f===v||f+t-1<v?(f=v,delete c[g],m()):c[g]=requestAnimationFrame(l)}),g},s=function(m){c[m]&&cancelAnimationFrame(c[m])}):(e=function(m){return setTimeout(m,t)},s=function(m){return clearTimeout(m)}),{frame:e,cancel:s}})(),i=(function(){var t,e,s={};function c(f){function m(g,l){f.postMessage({options:g||{},callback:l})}f.init=function(l){var v=l.transferControlToOffscreen();f.postMessage({canvas:v},[v])},f.fire=function(l,v,M){if(e)return m(l,null),e;var x=Math.random().toString(36).slice(2);return e=C(function(b){function I(L){L.data.callback===x&&(delete s[x],f.removeEventListener("message",I),e=null,y.clear(),M(),b())}f.addEventListener("message",I),m(l,x),s[x]=I.bind(null,{data:{callback:x}})}),e},f.reset=function(){f.postMessage({reset:!0});for(var l in s)s[l](),delete s[l]}}return function(){if(t)return t;if(!d&&n){var f=["var CONFETTI, SIZE = {}, module = {};","("+o.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{t=new Worker(URL.createObjectURL(new Blob([f])))}catch(m){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("ðŸŽŠ Could not load worker",m),null}c(t)}return t}})(),B={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function V(t,e){return e?e(t):t}function pe(t){return t!=null}function T(t,e,s){return V(t&&pe(t[e])?t[e]:B[e],s)}function ye(t){return t<0?0:Math.floor(t)}function we(t,e){return Math.floor(Math.random()*(e-t))+t}function q(t){return parseInt(t,16)}function Me(t){return t.map(be)}function be(t){var e=String(t).replace(/[^0-9a-f]/gi,"");return e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),{r:q(e.substring(0,2)),g:q(e.substring(2,4)),b:q(e.substring(4,6))}}function Se(t){var e=T(t,"origin",Object);return e.x=T(e,"x",Number),e.y=T(e,"y",Number),e}function xe(t){t.width=document.documentElement.clientWidth,t.height=document.documentElement.clientHeight}function Ie(t){var e=t.getBoundingClientRect();t.width=e.width,t.height=e.height}function Te(t){var e=document.createElement("canvas");return e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.pointerEvents="none",e.style.zIndex=t,e}function Ce(t,e,s,c,f,m,g,l,v){t.save(),t.translate(e,s),t.rotate(m),t.scale(c,f),t.arc(0,0,1,g,l,v),t.restore()}function Ee(t){var e=t.angle*(Math.PI/180),s=t.spread*(Math.PI/180);return{x:t.x,y:t.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:t.startVelocity*.5+Math.random()*t.startVelocity,angle2D:-e+(.5*s-Math.random()*s),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:t.color,shape:t.shape,tick:0,totalTicks:t.ticks,decay:t.decay,drift:t.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:t.gravity*3,ovalScalar:.6,scalar:t.scalar,flat:t.flat}}function Le(t,e){e.x+=Math.cos(e.angle2D)*e.velocity+e.drift,e.y+=Math.sin(e.angle2D)*e.velocity+e.gravity,e.velocity*=e.decay,e.flat?(e.wobble=0,e.wobbleX=e.x+10*e.scalar,e.wobbleY=e.y+10*e.scalar,e.tiltSin=0,e.tiltCos=0,e.random=1):(e.wobble+=e.wobbleSpeed,e.wobbleX=e.x+10*e.scalar*Math.cos(e.wobble),e.wobbleY=e.y+10*e.scalar*Math.sin(e.wobble),e.tiltAngle+=.1,e.tiltSin=Math.sin(e.tiltAngle),e.tiltCos=Math.cos(e.tiltAngle),e.random=Math.random()+2);var s=e.tick++/e.totalTicks,c=e.x+e.random*e.tiltCos,f=e.y+e.random*e.tiltSin,m=e.wobbleX+e.random*e.tiltCos,g=e.wobbleY+e.random*e.tiltSin;if(t.fillStyle="rgba("+e.color.r+", "+e.color.g+", "+e.color.b+", "+(1-s)+")",t.beginPath(),S&&e.shape.type==="path"&&typeof e.shape.path=="string"&&Array.isArray(e.shape.matrix))t.fill(Pe(e.shape.path,e.shape.matrix,e.x,e.y,Math.abs(m-c)*.1,Math.abs(g-f)*.1,Math.PI/10*e.wobble));else if(e.shape.type==="bitmap"){var l=Math.PI/10*e.wobble,v=Math.abs(m-c)*.1,M=Math.abs(g-f)*.1,x=e.shape.bitmap.width*e.scalar,b=e.shape.bitmap.height*e.scalar,I=new DOMMatrix([Math.cos(l)*v,Math.sin(l)*v,-Math.sin(l)*M,Math.cos(l)*M,e.x,e.y]);I.multiplySelf(new DOMMatrix(e.shape.matrix));var L=t.createPattern(y.transform(e.shape.bitmap),"no-repeat");L.setTransform(I),t.globalAlpha=1-s,t.fillStyle=L,t.fillRect(e.x-x/2,e.y-b/2,x,b),t.globalAlpha=1}else if(e.shape==="circle")t.ellipse?t.ellipse(e.x,e.y,Math.abs(m-c)*e.ovalScalar,Math.abs(g-f)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI):Ce(t,e.x,e.y,Math.abs(m-c)*e.ovalScalar,Math.abs(g-f)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI);else if(e.shape==="star")for(var p=Math.PI/2*3,O=4*e.scalar,k=8*e.scalar,N=e.x,R=e.y,H=5,A=Math.PI/H;H--;)N=e.x+Math.cos(p)*k,R=e.y+Math.sin(p)*k,t.lineTo(N,R),p+=A,N=e.x+Math.cos(p)*O,R=e.y+Math.sin(p)*O,t.lineTo(N,R),p+=A;else t.moveTo(Math.floor(e.x),Math.floor(e.y)),t.lineTo(Math.floor(e.wobbleX),Math.floor(f)),t.lineTo(Math.floor(m),Math.floor(g)),t.lineTo(Math.floor(c),Math.floor(e.wobbleY));return t.closePath(),t.fill(),e.tick<e.totalTicks}function Oe(t,e,s,c,f){var m=e.slice(),g=t.getContext("2d"),l,v,M=C(function(x){function b(){l=v=null,g.clearRect(0,0,c.width,c.height),y.clear(),f(),x()}function I(){d&&!(c.width===h.width&&c.height===h.height)&&(c.width=t.width=h.width,c.height=t.height=h.height),!c.width&&!c.height&&(s(t),c.width=t.width,c.height=t.height),g.clearRect(0,0,c.width,c.height),m=m.filter(function(L){return Le(g,L)}),m.length?l=u.frame(I):b()}l=u.frame(I),v=b});return{addFettis:function(x){return m=m.concat(x),M},canvas:t,promise:M,reset:function(){l&&u.cancel(l),v&&v()}}}function te(t,e){var s=!t,c=!!T(e||{},"resize"),f=!1,m=T(e,"disableForReducedMotion",Boolean),g=n&&!!T(e||{},"useWorker"),l=g?i():null,v=s?xe:Ie,M=t&&l?!!t.__confetti_initialized:!1,x=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,b;function I(p,O,k){for(var N=T(p,"particleCount",ye),R=T(p,"angle",Number),H=T(p,"spread",Number),A=T(p,"startVelocity",Number),Be=T(p,"decay",Number),Ae=T(p,"gravity",Number),Fe=T(p,"drift",Number),ae=T(p,"colors",Me),Re=T(p,"ticks",Number),ne=T(p,"shapes"),De=T(p,"scalar"),ze=!!T(p,"flat"),ie=Se(p),se=N,Z=[],He=t.width*ie.x,Ue=t.height*ie.y;se--;)Z.push(Ee({x:He,y:Ue,angle:R,spread:H,startVelocity:A,color:ae[se%ae.length],shape:ne[we(0,ne.length)],ticks:Re,decay:Be,gravity:Ae,drift:Fe,scalar:De,flat:ze}));return b?b.addFettis(Z):(b=Oe(t,Z,v,O,k),b.promise)}function L(p){var O=m||T(p,"disableForReducedMotion",Boolean),k=T(p,"zIndex",Number);if(O&&x)return C(function(A){A()});s&&b?t=b.canvas:s&&!t&&(t=Te(k),document.body.appendChild(t)),c&&!M&&v(t);var N={width:t.width,height:t.height};l&&!M&&l.init(t),M=!0,l&&(t.__confetti_initialized=!0);function R(){if(l){var A={getBoundingClientRect:function(){if(!s)return t.getBoundingClientRect()}};v(A),l.postMessage({resize:{width:A.width,height:A.height}});return}N.width=N.height=null}function H(){b=null,c&&(f=!1,r.removeEventListener("resize",R)),s&&t&&(document.body.contains(t)&&document.body.removeChild(t),t=null,M=!1)}return c&&!f&&(f=!0,r.addEventListener("resize",R,!1)),l?l.fire(p,N,H):I(p,N,H)}return L.reset=function(){l&&l.reset(),b&&b.reset()},L}var J;function re(){return J||(J=te(null,{useWorker:!0,resize:!0})),J}function Pe(t,e,s,c,f,m,g){var l=new Path2D(t),v=new Path2D;v.addPath(l,new DOMMatrix(e));var M=new Path2D;return M.addPath(v,new DOMMatrix([Math.cos(g)*f,Math.sin(g)*f,-Math.sin(g)*m,Math.cos(g)*m,s,c])),M}function ke(t){if(!S)throw new Error("path confetti are not supported in this browser");var e,s;typeof t=="string"?e=t:(e=t.path,s=t.matrix);var c=new Path2D(e),f=document.createElement("canvas"),m=f.getContext("2d");if(!s){for(var g=1e3,l=g,v=g,M=0,x=0,b,I,L=0;L<g;L+=2)for(var p=0;p<g;p+=2)m.isPointInPath(c,L,p,"nonzero")&&(l=Math.min(l,L),v=Math.min(v,p),M=Math.max(M,L),x=Math.max(x,p));b=M-l,I=x-v;var O=10,k=Math.min(O/b,O/I);s=[k,0,0,k,-Math.round(b/2+l)*k,-Math.round(I/2+v)*k]}return{type:"path",path:e,matrix:s}}function Ne(t){var e,s=1,c="#000000",f='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof t=="string"?e=t:(e=t.text,s="scalar"in t?t.scalar:s,f="fontFamily"in t?t.fontFamily:f,c="color"in t?t.color:c);var m=10*s,g=""+m+"px "+f,l=new OffscreenCanvas(m,m),v=l.getContext("2d");v.font=g;var M=v.measureText(e),x=Math.ceil(M.actualBoundingBoxRight+M.actualBoundingBoxLeft),b=Math.ceil(M.actualBoundingBoxAscent+M.actualBoundingBoxDescent),I=2,L=M.actualBoundingBoxLeft+I,p=M.actualBoundingBoxAscent+I;x+=I+I,b+=I+I,l=new OffscreenCanvas(x,b),v=l.getContext("2d"),v.font=g,v.fillStyle=c,v.fillText(e,L,p);var O=1/s;return{type:"bitmap",bitmap:l.transferToImageBitmap(),matrix:[O,0,0,O,-x*O/2,-b*O/2]}}a.exports=function(){return re().apply(this,arguments)},a.exports.reset=function(){re().reset()},a.exports.create=te,a.exports.shapeFromPath=ke,a.exports.shapeFromText=Ne})((function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}})(),Y,!1);const oe=Y.exports;Y.exports.create;const X=document.getElementById("grid"),$e=document.getElementById("score"),We=document.getElementById("best"),je=document.getElementById("best-name"),_=document.getElementById("game-over-modal"),Ve=document.getElementById("final-score"),K=document.getElementById("name-modal"),W=document.getElementById("player-name-input"),he=document.getElementById("start-game-btn"),fe=document.getElementById("music-toggle"),le=document.getElementById("music-on-icon"),ce=document.getElementById("music-off-icon"),Q=document.getElementById("undo-btn"),de=document.querySelectorAll(".diff-option"),E=new Ge;let me="easy";const F={move:new Audio("https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"),merge:new Audio("https://assets.mixkit.co/active_storage/sfx/2016/2016-preview.mp3"),celebrate:new Audio("https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"),click:new Audio("https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3")},ue=["https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3"],D=new Audio;D.volume=.4;let z=!1;function ee(){if(!z)return;const o=ue[Math.floor(Math.random()*ue.length)];D.src=o,D.play().catch(()=>{z=!1,ge()})}D.onended=()=>ee();function ge(){fe.classList.toggle("off",!z),z?(le.classList.remove("hidden"),ce.classList.add("hidden")):(le.classList.add("hidden"),ce.classList.remove("hidden"))}fe.addEventListener("click",()=>{z=!z,z?D.src?D.play():ee():D.pause(),ge()});de.forEach(o=>{o.addEventListener("click",()=>{F.click.play(),de.forEach(r=>r.classList.remove("active")),o.classList.add("active"),me=o.getAttribute("data-value")})});function j(){const o=X.clientWidth,r=o<=520?6:o*.0375,a=(o-r*5)/4,d=a+r,h=new Set(E.getGrid().filter(n=>n!==null).map(n=>n.id));X.querySelectorAll(".tile").forEach(n=>{const S=parseInt(n.id.split("-")[1]);h.has(S)||n.remove()}),E.getGrid().forEach((n,S)=>{if(!n)return;const P=Math.floor(S/4),w=S%4,C=r+P*d,y=r+w*d;let u=document.getElementById(`tile-${n.id}`);if(!u){u=document.createElement("div"),u.id=`tile-${n.id}`,u.classList.add("tile"),u.style.transition="none",u.style.width=`${a}px`,u.style.height=`${a}px`,u.style.transform=`translate(${y}px, ${C}px)`;const V=document.createElement("div");V.classList.add("tile-inner"),u.appendChild(V),X.appendChild(u),u.offsetHeight,u.style.transition=""}const i=u.querySelector(".tile-inner");i.innerText=n.value.toString(),u.className=`tile tile-${n.value}`;const B=n.value.toString().length;B>=3&&u.classList.add(`tile-digits-${B}`),n.isNew&&u.classList.add("tile-new"),n.isMerged&&u.classList.add("tile-merged"),u.style.width=`${a}px`,u.style.height=`${a}px`,u.style.transform=`translate(${y}px, ${C}px)`}),$e.innerText=E.getScore().toString(),We.innerText=E.getBestScore().toString(),je.innerText=E.getPlayerName(),Q.style.opacity=E.canUndo()?"1":"0.5",E.isGameOver()?(Ve.innerText=E.getScore().toString(),_.classList.remove("hidden")):_.classList.add("hidden")}function _e(){return!_.classList.contains("hidden")||!K.classList.contains("hidden")}function U(o){if(E.isGameOver()||_e())return;const r=E.move(o);r.moved&&(r.merged?(F.merge.currentTime=0,F.merge.play(),setTimeout(()=>{F.merge.pause()},500)):(F.move.currentTime=0,F.move.play()),j(),qe())}function qe(){const o=[1024,2048,4096,8192],r=E.getGrid(),a=E.getCelebratedTiles();for(const d of r)if(d&&o.includes(d.value)&&!a.has(d.value)){a.add(d.value),E.saveState(),F.celebrate.play(),Je();break}}function Je(){const r=Date.now()+3e3,a={startVelocity:30,spread:360,ticks:60,zIndex:0},d=(n,S)=>Math.random()*(S-n)+n,h=setInterval(function(){const n=r-Date.now();if(n<=0)return clearInterval(h);const S=50*(n/3e3);oe({...a,particleCount:S,origin:{x:d(.1,.3),y:Math.random()-.2}}),oe({...a,particleCount:S,origin:{x:d(.7,.9),y:Math.random()-.2}})},250)}window.resetGame=()=>{F.click.play(),_.classList.add("hidden"),W.value=E.getPlayerName(),K.classList.remove("hidden"),W.focus()};he.addEventListener("click",()=>{F.click.play();const o=W.value.trim()||"Player";E.setPlayerName(o),K.classList.add("hidden"),E.init(!1,me),z&&!D.src&&ee(),j()});Q.addEventListener("click",()=>{E.undo()&&(F.click.play(),j())});W.addEventListener("keydown",o=>{o.key==="Enter"&&he.click()});document.addEventListener("keydown",o=>{document.activeElement!==W&&(o.key==="ArrowLeft"&&U("left"),o.key==="ArrowRight"&&U("right"),o.key==="ArrowUp"&&U("up"),o.key==="ArrowDown"&&U("down"),o.altKey&&o.key.toLowerCase()==="n"&&(o.preventDefault(),window.resetGame()),o.altKey&&o.key.toLowerCase()==="z"&&(o.preventDefault(),Q.click()))});let G,$;const ve=(o,r)=>{if(G===null||$===null)return;const a=o-G,d=r-$,h=30;Math.abs(a)>Math.abs(d)?Math.abs(a)>h&&U(a>0?"right":"left"):Math.abs(d)>h&&U(d>0?"down":"up"),G=$=null};document.addEventListener("touchstart",o=>{G=o.touches[0].clientX,$=o.touches[0].clientY},{passive:!0});document.addEventListener("touchend",o=>ve(o.changedTouches[0].clientX,o.changedTouches[0].clientY),{passive:!0});document.addEventListener("mousedown",o=>{G=o.clientX,$=o.clientY});document.addEventListener("mouseup",o=>ve(o.clientX,o.clientY));window.addEventListener("resize",j);E.init();j();
