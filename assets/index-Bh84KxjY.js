(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))d(u);new MutationObserver(u=>{for(const n of u)if(n.type==="childList")for(const S of n.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&d(S)}).observe(document,{childList:!0,subtree:!0});function a(u){const n={};return u.integrity&&(n.integrity=u.integrity),u.referrerPolicy&&(n.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?n.credentials="include":u.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function d(u){if(u.ep)return;u.ep=!0;const n=a(u);fetch(u.href,n)}})();class He{grid=Array(16).fill(null);score=0;bestScore=0;playerName="Player";tileCounter=0;celebratedTiles=new Set;difficulty="easy";history=[];constructor(){this.loadScores()}loadScores(){const r=localStorage.getItem("2048-best-score");if(r){const a=JSON.parse(r);this.bestScore=a.score,this.playerName=a.name}}saveScores(){localStorage.setItem("2048-best-score",JSON.stringify({score:this.bestScore,name:this.playerName}))}saveState(){const r=JSON.stringify({grid:this.grid,score:this.score,tileCounter:this.tileCounter,celebratedTiles:Array.from(this.celebratedTiles),isOver:this.isGameOver(),difficulty:this.difficulty});localStorage.setItem("2048-game-state",r)}loadState(){const r=localStorage.getItem("2048-game-state");if(r){const a=JSON.parse(r);return a.isOver?(localStorage.removeItem("2048-game-state"),!1):(this.grid=a.grid,this.score=a.score,this.tileCounter=a.tileCounter,this.celebratedTiles=new Set(a.celebratedTiles||[]),this.difficulty=a.difficulty||"easy",!0)}return!1}init(r=!0,a){r&&this.loadState()||(a&&(this.difficulty=a),this.reset())}reset(){this.grid=Array(16).fill(null),this.score=0,this.celebratedTiles=new Set,this.history=[],this.addTile(),this.addTile(),this.saveState()}addTile(){const r=this.grid.map((a,d)=>a===null?d:null).filter(a=>a!==null);if(r.length>0){const a=r[Math.floor(Math.random()*r.length)],d=Math.max(...this.grid.map(n=>n?n.value:0));let u=2;if(this.difficulty==="easy"){const n=[2,4,8];d>=128&&n.push(16),u=n[Math.floor(Math.random()*n.length)]}else if(d>=16){const n=Math.log2(d)-2,S=[];for(let w=1;w<=n;w++){const C=Math.max(1,Math.floor(200/Math.pow(2,w)));for(let y=0;y<C;y++)S.push(w)}const P=S[Math.floor(Math.random()*S.length)];u=Math.pow(2,P)}else u=Math.random()<.9?2:4;this.grid[a]={value:u,id:this.tileCounter++,isNew:!0,isMerged:!1}}}undo(){if(this.history.length===0)return!1;const r=this.history.pop(),a=JSON.parse(r);return this.grid=a.grid,this.score=a.score,this.tileCounter=a.tileCounter,this.celebratedTiles=new Set(a.celebratedTiles),this.saveState(),!0}isGameOver(){if(this.grid.some(a=>a===null))return!1;const r=4;for(let a=0;a<r;a++)for(let d=0;d<r;d++){const u=this.grid[a*r+d].value;if(d<r-1&&u===this.grid[a*r+d+1].value||a<r-1&&u===this.grid[(a+1)*r+d].value)return!1}return!0}move(r){const a=JSON.stringify({grid:this.grid.map(w=>w?{...w}:null),score:this.score,tileCounter:this.tileCounter,celebratedTiles:Array.from(this.celebratedTiles)});let d=!1,u=!1;const n=4;let S=Array(16).fill(null);const P=(w,C)=>w*n+C;if(r==="left"||r==="right")for(let w=0;w<n;w++){let C=[];for(let i=0;i<n;i++)C.push(this.grid[P(w,i)]);r==="right"&&C.reverse();let y=C.filter(i=>i!==null),h=[];for(let i=0;i<y.length;i++)if(i<y.length-1&&y[i].value===y[i+1].value){const z=y[i].value*2;h.push({value:z,id:y[i].id,isNew:!1,isMerged:!0}),this.score+=z,i++,d=!0,u=!0}else y[i].isNew=!1,y[i].isMerged=!1,h.push(y[i]);for(;h.length<n;)h.push(null);r==="right"&&h.reverse();for(let i=0;i<n;i++)this.grid[P(w,i)]?.id!==h[i]?.id&&(d=!0),S[P(w,i)]=h[i]}else for(let w=0;w<n;w++){let C=[];for(let i=0;i<n;i++)C.push(this.grid[P(i,w)]);r==="down"&&C.reverse();let y=C.filter(i=>i!==null),h=[];for(let i=0;i<y.length;i++)if(i<y.length-1&&y[i].value===y[i+1].value){const z=y[i].value*2;h.push({value:z,id:y[i].id,isNew:!1,isMerged:!0}),this.score+=z,i++,d=!0,u=!0}else y[i].isNew=!1,y[i].isMerged=!1,h.push(y[i]);for(;h.length<n;)h.push(null);r==="down"&&h.reverse();for(let i=0;i<n;i++)this.grid[P(i,w)]?.id!==h[i]?.id&&(d=!0),S[P(i,w)]=h[i]}return d&&(this.history.push(a),this.history.length>20&&this.history.shift(),this.grid=S,this.addTile(),this.score>this.bestScore&&(this.bestScore=this.score,this.saveScores()),this.saveState()),{moved:d,merged:u}}getGrid(){return this.grid}getScore(){return this.score}getBestScore(){return this.bestScore}getPlayerName(){return this.playerName}getCelebratedTiles(){return this.celebratedTiles}getDifficulty(){return this.difficulty}canUndo(){return this.history.length>0}setPlayerName(r){this.playerName=r,this.saveScores()}}var Y={};(function l(r,a,d,u){var n=!!(r.Worker&&r.Blob&&r.Promise&&r.OffscreenCanvas&&r.OffscreenCanvasRenderingContext2D&&r.HTMLCanvasElement&&r.HTMLCanvasElement.prototype.transferControlToOffscreen&&r.URL&&r.URL.createObjectURL),S=typeof Path2D=="function"&&typeof DOMMatrix=="function",P=(function(){if(!r.OffscreenCanvas)return!1;try{var t=new OffscreenCanvas(1,1),e=t.getContext("2d");e.fillRect(0,0,1,1);var s=t.transferToImageBitmap();e.createPattern(s,"no-repeat")}catch{return!1}return!0})();function w(){}function C(t){var e=a.exports.Promise,s=e!==void 0?e:r.Promise;return typeof s=="function"?new s(t):(t(w,w),null)}var y=(function(t,e){return{transform:function(s){if(t)return s;if(e.has(s))return e.get(s);var c=new OffscreenCanvas(s.width,s.height),f=c.getContext("2d");return f.drawImage(s,0,0),e.set(s,c),c},clear:function(){e.clear()}}})(P,new Map),h=(function(){var t=Math.floor(16.666666666666668),e,s,c={},f=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(e=function(m){var g=Math.random();return c[g]=requestAnimationFrame(function o(v){f===v||f+t-1<v?(f=v,delete c[g],m()):c[g]=requestAnimationFrame(o)}),g},s=function(m){c[m]&&cancelAnimationFrame(c[m])}):(e=function(m){return setTimeout(m,t)},s=function(m){return clearTimeout(m)}),{frame:e,cancel:s}})(),i=(function(){var t,e,s={};function c(f){function m(g,o){f.postMessage({options:g||{},callback:o})}f.init=function(o){var v=o.transferControlToOffscreen();f.postMessage({canvas:v},[v])},f.fire=function(o,v,M){if(e)return m(o,null),e;var x=Math.random().toString(36).slice(2);return e=C(function(b){function T(L){L.data.callback===x&&(delete s[x],f.removeEventListener("message",T),e=null,y.clear(),M(),b())}f.addEventListener("message",T),m(o,x),s[x]=T.bind(null,{data:{callback:x}})}),e},f.reset=function(){f.postMessage({reset:!0});for(var o in s)s[o](),delete s[o]}}return function(){if(t)return t;if(!d&&n){var f=["var CONFETTI, SIZE = {}, module = {};","("+l.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{t=new Worker(URL.createObjectURL(new Blob([f])))}catch(m){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("ðŸŽŠ Could not load worker",m),null}c(t)}return t}})(),z={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function me(t,e){return e?e(t):t}function ge(t){return t!=null}function I(t,e,s){return me(t&&ge(t[e])?t[e]:z[e],s)}function ve(t){return t<0?0:Math.floor(t)}function pe(t,e){return Math.floor(Math.random()*(e-t))+t}function _(t){return parseInt(t,16)}function ye(t){return t.map(we)}function we(t){var e=String(t).replace(/[^0-9a-f]/gi,"");return e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),{r:_(e.substring(0,2)),g:_(e.substring(2,4)),b:_(e.substring(4,6))}}function Me(t){var e=I(t,"origin",Object);return e.x=I(e,"x",Number),e.y=I(e,"y",Number),e}function be(t){t.width=document.documentElement.clientWidth,t.height=document.documentElement.clientHeight}function Se(t){var e=t.getBoundingClientRect();t.width=e.width,t.height=e.height}function xe(t){var e=document.createElement("canvas");return e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.pointerEvents="none",e.style.zIndex=t,e}function Te(t,e,s,c,f,m,g,o,v){t.save(),t.translate(e,s),t.rotate(m),t.scale(c,f),t.arc(0,0,1,g,o,v),t.restore()}function Ie(t){var e=t.angle*(Math.PI/180),s=t.spread*(Math.PI/180);return{x:t.x,y:t.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:t.startVelocity*.5+Math.random()*t.startVelocity,angle2D:-e+(.5*s-Math.random()*s),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:t.color,shape:t.shape,tick:0,totalTicks:t.ticks,decay:t.decay,drift:t.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:t.gravity*3,ovalScalar:.6,scalar:t.scalar,flat:t.flat}}function Ce(t,e){e.x+=Math.cos(e.angle2D)*e.velocity+e.drift,e.y+=Math.sin(e.angle2D)*e.velocity+e.gravity,e.velocity*=e.decay,e.flat?(e.wobble=0,e.wobbleX=e.x+10*e.scalar,e.wobbleY=e.y+10*e.scalar,e.tiltSin=0,e.tiltCos=0,e.random=1):(e.wobble+=e.wobbleSpeed,e.wobbleX=e.x+10*e.scalar*Math.cos(e.wobble),e.wobbleY=e.y+10*e.scalar*Math.sin(e.wobble),e.tiltAngle+=.1,e.tiltSin=Math.sin(e.tiltAngle),e.tiltCos=Math.cos(e.tiltAngle),e.random=Math.random()+2);var s=e.tick++/e.totalTicks,c=e.x+e.random*e.tiltCos,f=e.y+e.random*e.tiltSin,m=e.wobbleX+e.random*e.tiltCos,g=e.wobbleY+e.random*e.tiltSin;if(t.fillStyle="rgba("+e.color.r+", "+e.color.g+", "+e.color.b+", "+(1-s)+")",t.beginPath(),S&&e.shape.type==="path"&&typeof e.shape.path=="string"&&Array.isArray(e.shape.matrix))t.fill(Le(e.shape.path,e.shape.matrix,e.x,e.y,Math.abs(m-c)*.1,Math.abs(g-f)*.1,Math.PI/10*e.wobble));else if(e.shape.type==="bitmap"){var o=Math.PI/10*e.wobble,v=Math.abs(m-c)*.1,M=Math.abs(g-f)*.1,x=e.shape.bitmap.width*e.scalar,b=e.shape.bitmap.height*e.scalar,T=new DOMMatrix([Math.cos(o)*v,Math.sin(o)*v,-Math.sin(o)*M,Math.cos(o)*M,e.x,e.y]);T.multiplySelf(new DOMMatrix(e.shape.matrix));var L=t.createPattern(y.transform(e.shape.bitmap),"no-repeat");L.setTransform(T),t.globalAlpha=1-s,t.fillStyle=L,t.fillRect(e.x-x/2,e.y-b/2,x,b),t.globalAlpha=1}else if(e.shape==="circle")t.ellipse?t.ellipse(e.x,e.y,Math.abs(m-c)*e.ovalScalar,Math.abs(g-f)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI):Te(t,e.x,e.y,Math.abs(m-c)*e.ovalScalar,Math.abs(g-f)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI);else if(e.shape==="star")for(var p=Math.PI/2*3,O=4*e.scalar,k=8*e.scalar,N=e.x,A=e.y,H=5,B=Math.PI/H;H--;)N=e.x+Math.cos(p)*k,A=e.y+Math.sin(p)*k,t.lineTo(N,A),p+=B,N=e.x+Math.cos(p)*O,A=e.y+Math.sin(p)*O,t.lineTo(N,A),p+=B;else t.moveTo(Math.floor(e.x),Math.floor(e.y)),t.lineTo(Math.floor(e.wobbleX),Math.floor(f)),t.lineTo(Math.floor(m),Math.floor(g)),t.lineTo(Math.floor(c),Math.floor(e.wobbleY));return t.closePath(),t.fill(),e.tick<e.totalTicks}function Ee(t,e,s,c,f){var m=e.slice(),g=t.getContext("2d"),o,v,M=C(function(x){function b(){o=v=null,g.clearRect(0,0,c.width,c.height),y.clear(),f(),x()}function T(){d&&!(c.width===u.width&&c.height===u.height)&&(c.width=t.width=u.width,c.height=t.height=u.height),!c.width&&!c.height&&(s(t),c.width=t.width,c.height=t.height),g.clearRect(0,0,c.width,c.height),m=m.filter(function(L){return Ce(g,L)}),m.length?o=h.frame(T):b()}o=h.frame(T),v=b});return{addFettis:function(x){return m=m.concat(x),M},canvas:t,promise:M,reset:function(){o&&h.cancel(o),v&&v()}}}function te(t,e){var s=!t,c=!!I(e||{},"resize"),f=!1,m=I(e,"disableForReducedMotion",Boolean),g=n&&!!I(e||{},"useWorker"),o=g?i():null,v=s?be:Se,M=t&&o?!!t.__confetti_initialized:!1,x=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,b;function T(p,O,k){for(var N=I(p,"particleCount",ve),A=I(p,"angle",Number),H=I(p,"spread",Number),B=I(p,"startVelocity",Number),ke=I(p,"decay",Number),Ne=I(p,"gravity",Number),Be=I(p,"drift",Number),ae=I(p,"colors",ye),Ae=I(p,"ticks",Number),ne=I(p,"shapes"),Fe=I(p,"scalar"),Re=!!I(p,"flat"),ie=Me(p),se=N,J=[],De=t.width*ie.x,ze=t.height*ie.y;se--;)J.push(Ie({x:De,y:ze,angle:A,spread:H,startVelocity:B,color:ae[se%ae.length],shape:ne[pe(0,ne.length)],ticks:Ae,decay:ke,gravity:Ne,drift:Be,scalar:Fe,flat:Re}));return b?b.addFettis(J):(b=Ee(t,J,v,O,k),b.promise)}function L(p){var O=m||I(p,"disableForReducedMotion",Boolean),k=I(p,"zIndex",Number);if(O&&x)return C(function(B){B()});s&&b?t=b.canvas:s&&!t&&(t=xe(k),document.body.appendChild(t)),c&&!M&&v(t);var N={width:t.width,height:t.height};o&&!M&&o.init(t),M=!0,o&&(t.__confetti_initialized=!0);function A(){if(o){var B={getBoundingClientRect:function(){if(!s)return t.getBoundingClientRect()}};v(B),o.postMessage({resize:{width:B.width,height:B.height}});return}N.width=N.height=null}function H(){b=null,c&&(f=!1,r.removeEventListener("resize",A)),s&&t&&(document.body.contains(t)&&document.body.removeChild(t),t=null,M=!1)}return c&&!f&&(f=!0,r.addEventListener("resize",A,!1)),o?o.fire(p,N,H):T(p,N,H)}return L.reset=function(){o&&o.reset(),b&&b.reset()},L}var q;function re(){return q||(q=te(null,{useWorker:!0,resize:!0})),q}function Le(t,e,s,c,f,m,g){var o=new Path2D(t),v=new Path2D;v.addPath(o,new DOMMatrix(e));var M=new Path2D;return M.addPath(v,new DOMMatrix([Math.cos(g)*f,Math.sin(g)*f,-Math.sin(g)*m,Math.cos(g)*m,s,c])),M}function Oe(t){if(!S)throw new Error("path confetti are not supported in this browser");var e,s;typeof t=="string"?e=t:(e=t.path,s=t.matrix);var c=new Path2D(e),f=document.createElement("canvas"),m=f.getContext("2d");if(!s){for(var g=1e3,o=g,v=g,M=0,x=0,b,T,L=0;L<g;L+=2)for(var p=0;p<g;p+=2)m.isPointInPath(c,L,p,"nonzero")&&(o=Math.min(o,L),v=Math.min(v,p),M=Math.max(M,L),x=Math.max(x,p));b=M-o,T=x-v;var O=10,k=Math.min(O/b,O/T);s=[k,0,0,k,-Math.round(b/2+o)*k,-Math.round(T/2+v)*k]}return{type:"path",path:e,matrix:s}}function Pe(t){var e,s=1,c="#000000",f='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof t=="string"?e=t:(e=t.text,s="scalar"in t?t.scalar:s,f="fontFamily"in t?t.fontFamily:f,c="color"in t?t.color:c);var m=10*s,g=""+m+"px "+f,o=new OffscreenCanvas(m,m),v=o.getContext("2d");v.font=g;var M=v.measureText(e),x=Math.ceil(M.actualBoundingBoxRight+M.actualBoundingBoxLeft),b=Math.ceil(M.actualBoundingBoxAscent+M.actualBoundingBoxDescent),T=2,L=M.actualBoundingBoxLeft+T,p=M.actualBoundingBoxAscent+T;x+=T+T,b+=T+T,o=new OffscreenCanvas(x,b),v=o.getContext("2d"),v.font=g,v.fillStyle=c,v.fillText(e,L,p);var O=1/s;return{type:"bitmap",bitmap:o.transferToImageBitmap(),matrix:[O,0,0,O,-x*O/2,-b*O/2]}}a.exports=function(){return re().apply(this,arguments)},a.exports.reset=function(){re().reset()},a.exports.create=te,a.exports.shapeFromPath=Oe,a.exports.shapeFromText=Pe})((function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}})(),Y,!1);const oe=Y.exports;Y.exports.create;const Z=document.getElementById("grid"),Ue=document.getElementById("score"),Ge=document.getElementById("best"),$e=document.getElementById("best-name"),V=document.getElementById("game-over-modal"),We=document.getElementById("final-score"),K=document.getElementById("name-modal"),W=document.getElementById("player-name-input"),de=document.getElementById("start-game-btn"),X=document.getElementById("music-toggle"),Q=document.getElementById("undo-btn"),le=document.querySelectorAll(".diff-option"),E=new He;let ue="easy";const F={move:new Audio("https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"),merge:new Audio("https://assets.mixkit.co/active_storage/sfx/2016/2016-preview.mp3"),celebrate:new Audio("https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"),click:new Audio("https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3")},ce=["https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3"],R=new Audio;R.loop=!1;let D=!1;function ee(){if(!D)return;const l=ce[Math.floor(Math.random()*ce.length)];R.src=l,R.play().catch(()=>{D=!1,he()})}R.onended=()=>ee();function he(){X.innerText=D?"ðŸŽµ On":"ðŸŽµ Off",X.classList.toggle("off",!D)}X.addEventListener("click",()=>{D=!D,D?R.src?R.play():ee():R.pause(),he()});le.forEach(l=>{l.addEventListener("click",()=>{F.click.play(),le.forEach(r=>r.classList.remove("active")),l.classList.add("active"),ue=l.getAttribute("data-value")})});function j(){const l=Z.clientWidth,r=l*.0375,a=(l-r*5)/4,d=a+r,u=new Set(E.getGrid().filter(n=>n!==null).map(n=>n.id));Z.querySelectorAll(".tile").forEach(n=>{const S=parseInt(n.id.split("-")[1]);u.has(S)||n.remove()}),E.getGrid().forEach((n,S)=>{if(!n)return;const P=Math.floor(S/4),w=S%4,C=r+P*d,y=r+w*d;let h=document.getElementById(`tile-${n.id}`);h||(h=document.createElement("div"),h.id=`tile-${n.id}`,h.classList.add("tile"),h.style.transition="none",h.style.width=`${a}px`,h.style.height=`${a}px`,h.style.transform=`translate(${y}px, ${C}px)`,Z.appendChild(h),h.offsetHeight,h.style.transition=""),h.innerText=n.value.toString(),h.className=`tile tile-${n.value}`;const i=n.value.toString().length;i>=4&&h.classList.add(`tile-digits-${i}`),n.isNew&&h.classList.add("tile-new"),n.isMerged&&h.classList.add("tile-merged"),h.style.width=`${a}px`,h.style.height=`${a}px`,h.style.transform=`translate(${y}px, ${C}px)`}),Ue.innerText=E.getScore().toString(),Ge.innerText=E.getBestScore().toString(),$e.innerText=E.getPlayerName(),Q.style.opacity=E.canUndo()?"1":"0.5",E.isGameOver()?(We.innerText=E.getScore().toString(),V.classList.remove("hidden")):V.classList.add("hidden")}function je(){return!V.classList.contains("hidden")||!K.classList.contains("hidden")}function U(l){if(E.isGameOver()||je())return;const r=E.move(l);r.moved&&(r.merged?(F.merge.currentTime=0,F.merge.play()):(F.move.currentTime=0,F.move.play()),j(),Ve())}function Ve(){const l=[1024,2048,4096,8192],r=E.getGrid(),a=E.getCelebratedTiles();for(const d of r)if(d&&l.includes(d.value)&&!a.has(d.value)){a.add(d.value),E.saveState(),F.celebrate.play(),_e();break}}function _e(){const r=Date.now()+3e3,a={startVelocity:30,spread:360,ticks:60,zIndex:0},d=(n,S)=>Math.random()*(S-n)+n,u=setInterval(function(){const n=r-Date.now();if(n<=0)return clearInterval(u);const S=50*(n/3e3);oe({...a,particleCount:S,origin:{x:d(.1,.3),y:Math.random()-.2}}),oe({...a,particleCount:S,origin:{x:d(.7,.9),y:Math.random()-.2}})},250)}window.resetGame=()=>{F.click.play(),V.classList.add("hidden"),W.value=E.getPlayerName(),K.classList.remove("hidden"),W.focus()};de.addEventListener("click",()=>{F.click.play();const l=W.value.trim()||"Player";E.setPlayerName(l),K.classList.add("hidden"),E.init(!1,ue),D&&!R.src&&ee(),j()});Q.addEventListener("click",()=>{E.undo()&&(F.click.play(),j())});W.addEventListener("keydown",l=>{l.key==="Enter"&&de.click()});document.addEventListener("keydown",l=>{document.activeElement!==W&&(l.key==="ArrowLeft"&&U("left"),l.key==="ArrowRight"&&U("right"),l.key==="ArrowUp"&&U("up"),l.key==="ArrowDown"&&U("down"),l.altKey&&l.key.toLowerCase()==="n"&&(l.preventDefault(),window.resetGame()),l.altKey&&l.key.toLowerCase()==="z"&&(l.preventDefault(),Q.click()))});let G,$;const fe=(l,r)=>{if(G===null||$===null)return;const a=l-G,d=r-$,u=30;Math.abs(a)>Math.abs(d)?Math.abs(a)>u&&U(a>0?"right":"left"):Math.abs(d)>u&&U(d>0?"down":"up"),G=$=null};document.addEventListener("touchstart",l=>{G=l.touches[0].clientX,$=l.touches[0].clientY},{passive:!0});document.addEventListener("touchend",l=>fe(l.changedTouches[0].clientX,l.changedTouches[0].clientY),{passive:!0});document.addEventListener("mousedown",l=>{G=l.clientX,$=l.clientY});document.addEventListener("mouseup",l=>fe(l.clientX,l.clientY));window.addEventListener("resize",j);E.init();j();
