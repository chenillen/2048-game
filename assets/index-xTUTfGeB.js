(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const t of l)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function i(l){const t={};return l.integrity&&(t.integrity=l.integrity),l.referrerPolicy&&(t.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?t.credentials="include":l.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function n(l){if(l.ep)return;l.ep=!0;const t=i(l);fetch(l.href,t)}})();class w{grid=Array(16).fill(null);score=0;bestScore=0;playerName="Player";tileCounter=0;constructor(){this.loadScores()}loadScores(){const s=localStorage.getItem("2048-best-score");if(s){const i=JSON.parse(s);this.bestScore=i.score,this.playerName=i.name}}saveScores(){localStorage.setItem("2048-best-score",JSON.stringify({score:this.bestScore,name:this.playerName}))}saveState(){localStorage.setItem("2048-game-state",JSON.stringify({grid:this.grid,score:this.score,tileCounter:this.tileCounter}))}loadState(){const s=localStorage.getItem("2048-game-state");if(s){const i=JSON.parse(s);return this.grid=i.grid,this.score=i.score,this.tileCounter=i.tileCounter,!0}return!1}init(s=!0){s&&this.loadState()||(this.grid=Array(16).fill(null),this.score=0,this.addTile(),this.addTile())}addTile(){const s=this.grid.map((i,n)=>i===null?n:null).filter(i=>i!==null);if(s.length>0){const i=s[Math.floor(Math.random()*s.length)];this.grid[i]={value:Math.random()<.9?2:4,id:this.tileCounter++,isNew:!0,isMerged:!1}}}move(s){let i=!1;const n=4;let l=Array(16).fill(null);const t=(o,u)=>o*n+u;if(s==="left"||s==="right")for(let o=0;o<n;o++){let u=[];for(let e=0;e<n;e++)u.push(this.grid[t(o,e)]);s==="right"&&u.reverse();let a=u.filter(e=>e!==null),d=[];for(let e=0;e<a.length;e++)if(e<a.length-1&&a[e].value===a[e+1].value){const c=a[e].value*2;d.push({value:c,id:a[e].id,isNew:!1,isMerged:!0}),this.score+=c,e++,i=!0}else a[e].isNew=!1,a[e].isMerged=!1,d.push(a[e]);for(;d.length<n;)d.push(null);s==="right"&&d.reverse();for(let e=0;e<n;e++)this.grid[t(o,e)]?.id!==d[e]?.id&&(i=!0),l[t(o,e)]=d[e]}else for(let o=0;o<n;o++){let u=[];for(let e=0;e<n;e++)u.push(this.grid[t(e,o)]);s==="down"&&u.reverse();let a=u.filter(e=>e!==null),d=[];for(let e=0;e<a.length;e++)if(e<a.length-1&&a[e].value===a[e+1].value){const c=a[e].value*2;d.push({value:c,id:a[e].id,isNew:!1,isMerged:!0}),this.score+=c,e++,i=!0}else a[e].isNew=!1,a[e].isMerged=!1,d.push(a[e]);for(;d.length<n;)d.push(null);s==="down"&&d.reverse();for(let e=0;e<n;e++)this.grid[t(e,o)]?.id!==d[e]?.id&&(i=!0),l[t(e,o)]=d[e]}return i&&(this.grid=l,this.addTile(),this.score>this.bestScore&&(this.bestScore=this.score,this.saveScores()),this.saveState()),i}getGrid(){return this.grid}getScore(){return this.score}getBestScore(){return this.bestScore}getPlayerName(){return this.playerName}setPlayerName(s){this.playerName=s,this.saveScores()}}const y=document.getElementById("grid"),S=document.getElementById("score"),N=document.getElementById("best"),h=new w;function p(){const r=y.clientWidth,s=r*.0375,i=(r-s*5)/4,n=i+s,l=new Set(h.getGrid().filter(t=>t!==null).map(t=>t.id));y.querySelectorAll(".tile").forEach(t=>{const o=parseInt(t.id.split("-")[1]);l.has(o)||t.remove()}),h.getGrid().forEach((t,o)=>{if(!t)return;const u=Math.floor(o/4),a=o%4,d=s+u*n,e=s+a*n;let c=document.getElementById(`tile-${t.id}`);c||(c=document.createElement("div"),c.id=`tile-${t.id}`,c.classList.add("tile"),y.appendChild(c)),c.innerText=t.value.toString(),c.className=`tile tile-${t.value}`,t.isNew&&c.classList.add("tile-new"),t.isMerged&&c.classList.add("tile-merged"),c.style.width=`${i}px`,c.style.height=`${i}px`,c.style.transform=`translate(${e}px, ${d}px)`}),S.innerText=h.getScore().toString(),N.innerText=h.getBestScore().toString()}function f(r){h.move(r)&&p()}window.resetGame=()=>{const r=prompt("Enter your name for high scores:",h.getPlayerName());r&&h.setPlayerName(r),h.init(!1),p()};document.addEventListener("keydown",r=>{r.key==="ArrowLeft"&&f("left"),r.key==="ArrowRight"&&f("right"),r.key==="ArrowUp"&&f("up"),r.key==="ArrowDown"&&f("down"),(r.metaKey||r.ctrlKey)&&r.key==="n"&&(r.preventDefault(),window.resetGame())});let g,m;const v=(r,s)=>{if(g===null||m===null)return;const i=r-g,n=s-m,l=30;Math.abs(i)>Math.abs(n)?Math.abs(i)>l&&f(i>0?"right":"left"):Math.abs(n)>l&&f(n>0?"down":"up"),g=m=null};document.addEventListener("touchstart",r=>{g=r.touches[0].clientX,m=r.touches[0].clientY},{passive:!0});document.addEventListener("touchend",r=>v(r.changedTouches[0].clientX,r.changedTouches[0].clientY),{passive:!0});document.addEventListener("mousedown",r=>{g=r.clientX,m=r.clientY});document.addEventListener("mouseup",r=>v(r.clientX,r.clientY));window.addEventListener("resize",p);h.init();p();
