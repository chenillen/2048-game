(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))c(u);new MutationObserver(u=>{for(const s of u)if(s.type==="childList")for(const v of s.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&c(v)}).observe(document,{childList:!0,subtree:!0});function n(u){const s={};return u.integrity&&(s.integrity=u.integrity),u.referrerPolicy&&(s.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?s.credentials="include":u.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(u){if(u.ep)return;u.ep=!0;const s=n(u);fetch(u.href,s)}})();class Pe{grid=Array(16).fill(null);score=0;bestScore=0;playerName="Player";tileCounter=0;celebratedTiles=new Set;constructor(){this.loadScores()}loadScores(){const a=localStorage.getItem("2048-best-score");if(a){const n=JSON.parse(a);this.bestScore=n.score,this.playerName=n.name}}saveScores(){localStorage.setItem("2048-best-score",JSON.stringify({score:this.bestScore,name:this.playerName}))}saveState(){localStorage.setItem("2048-game-state",JSON.stringify({grid:this.grid,score:this.score,tileCounter:this.tileCounter,celebratedTiles:Array.from(this.celebratedTiles),isOver:this.isGameOver()}))}loadState(){const a=localStorage.getItem("2048-game-state");if(a){const n=JSON.parse(a);return n.isOver?(localStorage.removeItem("2048-game-state"),!1):(this.grid=n.grid,this.score=n.score,this.tileCounter=n.tileCounter,this.celebratedTiles=new Set(n.celebratedTiles||[]),!0)}return!1}init(a=!0){if(a&&this.loadState()){this.isGameOver()&&this.reset();return}this.reset()}reset(){this.grid=Array(16).fill(null),this.score=0,this.celebratedTiles=new Set,this.addTile(),this.addTile(),this.saveState()}addTile(){const a=this.grid.map((n,c)=>n===null?c:null).filter(n=>n!==null);if(a.length>0){const n=a[Math.floor(Math.random()*a.length)],c=Math.max(...this.grid.map(s=>s?s.value:0));let u=2;if(c>=16){const s=Math.log2(c)-2,v=[];for(let y=1;y<=s;y++){const S=Math.floor(200/Math.pow(2,y));for(let r=0;r<S;r++)v.push(y)}const L=v[Math.floor(Math.random()*v.length)];u=Math.pow(2,L)}else u=Math.random()<.9?2:4;this.grid[n]={value:u,id:this.tileCounter++,isNew:!0,isMerged:!1}}}isGameOver(){if(this.grid.some(n=>n===null))return!1;const a=4;for(let n=0;n<a;n++)for(let c=0;c<a;c++){const u=this.grid[n*a+c].value;if(c<a-1&&u===this.grid[n*a+c+1].value||n<a-1&&u===this.grid[(n+1)*a+c].value)return!1}return!0}move(a){let n=!1;const c=4;let u=Array(16).fill(null);const s=(v,L)=>v*c+L;if(a==="left"||a==="right")for(let v=0;v<c;v++){let L=[];for(let r=0;r<c;r++)L.push(this.grid[s(v,r)]);a==="right"&&L.reverse();let y=L.filter(r=>r!==null),S=[];for(let r=0;r<y.length;r++)if(r<y.length-1&&y[r].value===y[r+1].value){const M=y[r].value*2;S.push({value:M,id:y[r].id,isNew:!1,isMerged:!0}),this.score+=M,r++,n=!0}else y[r].isNew=!1,y[r].isMerged=!1,S.push(y[r]);for(;S.length<c;)S.push(null);a==="right"&&S.reverse();for(let r=0;r<c;r++)this.grid[s(v,r)]?.id!==S[r]?.id&&(n=!0),u[s(v,r)]=S[r]}else for(let v=0;v<c;v++){let L=[];for(let r=0;r<c;r++)L.push(this.grid[s(r,v)]);a==="down"&&L.reverse();let y=L.filter(r=>r!==null),S=[];for(let r=0;r<y.length;r++)if(r<y.length-1&&y[r].value===y[r+1].value){const M=y[r].value*2;S.push({value:M,id:y[r].id,isNew:!1,isMerged:!0}),this.score+=M,r++,n=!0}else y[r].isNew=!1,y[r].isMerged=!1,S.push(y[r]);for(;S.length<c;)S.push(null);a==="down"&&S.reverse();for(let r=0;r<c;r++)this.grid[s(r,v)]?.id!==S[r]?.id&&(n=!0),u[s(r,v)]=S[r]}return n&&(this.grid=u,this.addTile(),this.score>this.bestScore&&(this.bestScore=this.score,this.saveScores()),this.saveState()),n}getGrid(){return this.grid}getScore(){return this.score}getBestScore(){return this.bestScore}getPlayerName(){return this.playerName}getCelebratedTiles(){return this.celebratedTiles}setPlayerName(a){this.playerName=a,this.saveScores()}}var Z={};(function f(a,n,c,u){var s=!!(a.Worker&&a.Blob&&a.Promise&&a.OffscreenCanvas&&a.OffscreenCanvasRenderingContext2D&&a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype.transferControlToOffscreen&&a.URL&&a.URL.createObjectURL),v=typeof Path2D=="function"&&typeof DOMMatrix=="function",L=(function(){if(!a.OffscreenCanvas)return!1;try{var t=new OffscreenCanvas(1,1),e=t.getContext("2d");e.fillRect(0,0,1,1);var i=t.transferToImageBitmap();e.createPattern(i,"no-repeat")}catch{return!1}return!0})();function y(){}function S(t){var e=n.exports.Promise,i=e!==void 0?e:a.Promise;return typeof i=="function"?new i(t):(t(y,y),null)}var r=(function(t,e){return{transform:function(i){if(t)return i;if(e.has(i))return e.get(i);var l=new OffscreenCanvas(i.width,i.height),d=l.getContext("2d");return d.drawImage(i,0,0),e.set(i,l),l},clear:function(){e.clear()}}})(L,new Map),M=(function(){var t=Math.floor(16.666666666666668),e,i,l={},d=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(e=function(h){var m=Math.random();return l[m]=requestAnimationFrame(function o(g){d===g||d+t-1<g?(d=g,delete l[m],h()):l[m]=requestAnimationFrame(o)}),m},i=function(h){l[h]&&cancelAnimationFrame(l[h])}):(e=function(h){return setTimeout(h,t)},i=function(h){return clearTimeout(h)}),{frame:e,cancel:i}})(),G=(function(){var t,e,i={};function l(d){function h(m,o){d.postMessage({options:m||{},callback:o})}d.init=function(o){var g=o.transferControlToOffscreen();d.postMessage({canvas:g},[g])},d.fire=function(o,g,w){if(e)return h(o,null),e;var I=Math.random().toString(36).slice(2);return e=S(function(b){function C(E){E.data.callback===I&&(delete i[I],d.removeEventListener("message",C),e=null,r.clear(),w(),b())}d.addEventListener("message",C),h(o,I),i[I]=C.bind(null,{data:{callback:I}})}),e},d.reset=function(){d.postMessage({reset:!0});for(var o in i)i[o](),delete i[o]}}return function(){if(t)return t;if(!c&&s){var d=["var CONFETTI, SIZE = {}, module = {};","("+f.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{t=new Worker(URL.createObjectURL(new Blob([d])))}catch(h){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("ðŸŽŠ Could not load worker",h),null}l(t)}return t}})(),ae={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function ne(t,e){return e?e(t):t}function ie(t){return t!=null}function T(t,e,i){return ne(t&&ie(t[e])?t[e]:ae[e],i)}function se(t){return t<0?0:Math.floor(t)}function oe(t,e){return Math.floor(Math.random()*(e-t))+t}function j(t){return parseInt(t,16)}function le(t){return t.map(ce)}function ce(t){var e=String(t).replace(/[^0-9a-f]/gi,"");return e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),{r:j(e.substring(0,2)),g:j(e.substring(2,4)),b:j(e.substring(4,6))}}function de(t){var e=T(t,"origin",Object);return e.x=T(e,"x",Number),e.y=T(e,"y",Number),e}function ue(t){t.width=document.documentElement.clientWidth,t.height=document.documentElement.clientHeight}function he(t){var e=t.getBoundingClientRect();t.width=e.width,t.height=e.height}function fe(t){var e=document.createElement("canvas");return e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.pointerEvents="none",e.style.zIndex=t,e}function me(t,e,i,l,d,h,m,o,g){t.save(),t.translate(e,i),t.rotate(h),t.scale(l,d),t.arc(0,0,1,m,o,g),t.restore()}function ge(t){var e=t.angle*(Math.PI/180),i=t.spread*(Math.PI/180);return{x:t.x,y:t.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:t.startVelocity*.5+Math.random()*t.startVelocity,angle2D:-e+(.5*i-Math.random()*i),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:t.color,shape:t.shape,tick:0,totalTicks:t.ticks,decay:t.decay,drift:t.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:t.gravity*3,ovalScalar:.6,scalar:t.scalar,flat:t.flat}}function ve(t,e){e.x+=Math.cos(e.angle2D)*e.velocity+e.drift,e.y+=Math.sin(e.angle2D)*e.velocity+e.gravity,e.velocity*=e.decay,e.flat?(e.wobble=0,e.wobbleX=e.x+10*e.scalar,e.wobbleY=e.y+10*e.scalar,e.tiltSin=0,e.tiltCos=0,e.random=1):(e.wobble+=e.wobbleSpeed,e.wobbleX=e.x+10*e.scalar*Math.cos(e.wobble),e.wobbleY=e.y+10*e.scalar*Math.sin(e.wobble),e.tiltAngle+=.1,e.tiltSin=Math.sin(e.tiltAngle),e.tiltCos=Math.cos(e.tiltAngle),e.random=Math.random()+2);var i=e.tick++/e.totalTicks,l=e.x+e.random*e.tiltCos,d=e.y+e.random*e.tiltSin,h=e.wobbleX+e.random*e.tiltCos,m=e.wobbleY+e.random*e.tiltSin;if(t.fillStyle="rgba("+e.color.r+", "+e.color.g+", "+e.color.b+", "+(1-i)+")",t.beginPath(),v&&e.shape.type==="path"&&typeof e.shape.path=="string"&&Array.isArray(e.shape.matrix))t.fill(ye(e.shape.path,e.shape.matrix,e.x,e.y,Math.abs(h-l)*.1,Math.abs(m-d)*.1,Math.PI/10*e.wobble));else if(e.shape.type==="bitmap"){var o=Math.PI/10*e.wobble,g=Math.abs(h-l)*.1,w=Math.abs(m-d)*.1,I=e.shape.bitmap.width*e.scalar,b=e.shape.bitmap.height*e.scalar,C=new DOMMatrix([Math.cos(o)*g,Math.sin(o)*g,-Math.sin(o)*w,Math.cos(o)*w,e.x,e.y]);C.multiplySelf(new DOMMatrix(e.shape.matrix));var E=t.createPattern(r.transform(e.shape.bitmap),"no-repeat");E.setTransform(C),t.globalAlpha=1-i,t.fillStyle=E,t.fillRect(e.x-I/2,e.y-b/2,I,b),t.globalAlpha=1}else if(e.shape==="circle")t.ellipse?t.ellipse(e.x,e.y,Math.abs(h-l)*e.ovalScalar,Math.abs(m-d)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI):me(t,e.x,e.y,Math.abs(h-l)*e.ovalScalar,Math.abs(m-d)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI);else if(e.shape==="star")for(var p=Math.PI/2*3,P=4*e.scalar,O=8*e.scalar,N=e.x,F=e.y,k=5,B=Math.PI/k;k--;)N=e.x+Math.cos(p)*O,F=e.y+Math.sin(p)*O,t.lineTo(N,F),p+=B,N=e.x+Math.cos(p)*P,F=e.y+Math.sin(p)*P,t.lineTo(N,F),p+=B;else t.moveTo(Math.floor(e.x),Math.floor(e.y)),t.lineTo(Math.floor(e.wobbleX),Math.floor(d)),t.lineTo(Math.floor(h),Math.floor(m)),t.lineTo(Math.floor(l),Math.floor(e.wobbleY));return t.closePath(),t.fill(),e.tick<e.totalTicks}function pe(t,e,i,l,d){var h=e.slice(),m=t.getContext("2d"),o,g,w=S(function(I){function b(){o=g=null,m.clearRect(0,0,l.width,l.height),r.clear(),d(),I()}function C(){c&&!(l.width===u.width&&l.height===u.height)&&(l.width=t.width=u.width,l.height=t.height=u.height),!l.width&&!l.height&&(i(t),l.width=t.width,l.height=t.height),m.clearRect(0,0,l.width,l.height),h=h.filter(function(E){return ve(m,E)}),h.length?o=M.frame(C):b()}o=M.frame(C),g=b});return{addFettis:function(I){return h=h.concat(I),w},canvas:t,promise:w,reset:function(){o&&M.cancel(o),g&&g()}}}function H(t,e){var i=!t,l=!!T(e||{},"resize"),d=!1,h=T(e,"disableForReducedMotion",Boolean),m=s&&!!T(e||{},"useWorker"),o=m?G():null,g=i?ue:he,w=t&&o?!!t.__confetti_initialized:!1,I=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,b;function C(p,P,O){for(var N=T(p,"particleCount",se),F=T(p,"angle",Number),k=T(p,"spread",Number),B=T(p,"startVelocity",Number),be=T(p,"decay",Number),Se=T(p,"gravity",Number),Ie=T(p,"drift",Number),X=T(p,"colors",le),Ce=T(p,"ticks",Number),Y=T(p,"shapes"),Te=T(p,"scalar"),Ee=!!T(p,"flat"),K=de(p),Q=N,V=[],xe=t.width*K.x,Le=t.height*K.y;Q--;)V.push(ge({x:xe,y:Le,angle:F,spread:k,startVelocity:B,color:X[Q%X.length],shape:Y[oe(0,Y.length)],ticks:Ce,decay:be,gravity:Se,drift:Ie,scalar:Te,flat:Ee}));return b?b.addFettis(V):(b=pe(t,V,g,P,O),b.promise)}function E(p){var P=h||T(p,"disableForReducedMotion",Boolean),O=T(p,"zIndex",Number);if(P&&I)return S(function(B){B()});i&&b?t=b.canvas:i&&!t&&(t=fe(O),document.body.appendChild(t)),l&&!w&&g(t);var N={width:t.width,height:t.height};o&&!w&&o.init(t),w=!0,o&&(t.__confetti_initialized=!0);function F(){if(o){var B={getBoundingClientRect:function(){if(!i)return t.getBoundingClientRect()}};g(B),o.postMessage({resize:{width:B.width,height:B.height}});return}N.width=N.height=null}function k(){b=null,l&&(d=!1,a.removeEventListener("resize",F)),i&&t&&(document.body.contains(t)&&document.body.removeChild(t),t=null,w=!1)}return l&&!d&&(d=!0,a.addEventListener("resize",F,!1)),o?o.fire(p,N,k):C(p,N,k)}return E.reset=function(){o&&o.reset(),b&&b.reset()},E}var U;function J(){return U||(U=H(null,{useWorker:!0,resize:!0})),U}function ye(t,e,i,l,d,h,m){var o=new Path2D(t),g=new Path2D;g.addPath(o,new DOMMatrix(e));var w=new Path2D;return w.addPath(g,new DOMMatrix([Math.cos(m)*d,Math.sin(m)*d,-Math.sin(m)*h,Math.cos(m)*h,i,l])),w}function Me(t){if(!v)throw new Error("path confetti are not supported in this browser");var e,i;typeof t=="string"?e=t:(e=t.path,i=t.matrix);var l=new Path2D(e),d=document.createElement("canvas"),h=d.getContext("2d");if(!i){for(var m=1e3,o=m,g=m,w=0,I=0,b,C,E=0;E<m;E+=2)for(var p=0;p<m;p+=2)h.isPointInPath(l,E,p,"nonzero")&&(o=Math.min(o,E),g=Math.min(g,p),w=Math.max(w,E),I=Math.max(I,p));b=w-o,C=I-g;var P=10,O=Math.min(P/b,P/C);i=[O,0,0,O,-Math.round(b/2+o)*O,-Math.round(C/2+g)*O]}return{type:"path",path:e,matrix:i}}function we(t){var e,i=1,l="#000000",d='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof t=="string"?e=t:(e=t.text,i="scalar"in t?t.scalar:i,d="fontFamily"in t?t.fontFamily:d,l="color"in t?t.color:l);var h=10*i,m=""+h+"px "+d,o=new OffscreenCanvas(h,h),g=o.getContext("2d");g.font=m;var w=g.measureText(e),I=Math.ceil(w.actualBoundingBoxRight+w.actualBoundingBoxLeft),b=Math.ceil(w.actualBoundingBoxAscent+w.actualBoundingBoxDescent),C=2,E=w.actualBoundingBoxLeft+C,p=w.actualBoundingBoxAscent+C;I+=C+C,b+=C+C,o=new OffscreenCanvas(I,b),g=o.getContext("2d"),g.font=m,g.fillStyle=l,g.fillText(e,E,p);var P=1/i;return{type:"bitmap",bitmap:o.transferToImageBitmap(),matrix:[P,0,0,P,-I*P/2,-b*P/2]}}n.exports=function(){return J().apply(this,arguments)},n.exports.reset=function(){J().reset()},n.exports.create=H,n.exports.shapeFromPath=Me,n.exports.shapeFromText=we})((function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}})(),Z,!1);const ee=Z.exports;Z.exports.create;const q=document.getElementById("grid"),Oe=document.getElementById("score"),Ne=document.getElementById("best"),Be=document.getElementById("best-name"),$=document.getElementById("game-over-modal"),Fe=document.getElementById("final-score"),_=document.getElementById("name-modal"),z=document.getElementById("player-name-input"),te=document.getElementById("start-game-btn"),x=new Pe;function W(){const f=q.clientWidth,a=f*.0375,n=(f-a*5)/4,c=n+a,u=new Set(x.getGrid().filter(s=>s!==null).map(s=>s.id));q.querySelectorAll(".tile").forEach(s=>{const v=parseInt(s.id.split("-")[1]);u.has(v)||s.remove()}),x.getGrid().forEach((s,v)=>{if(!s)return;const L=Math.floor(v/4),y=v%4,S=a+L*c,r=a+y*c;let M=document.getElementById(`tile-${s.id}`);M||(M=document.createElement("div"),M.id=`tile-${s.id}`,M.classList.add("tile"),M.style.transition="none",M.style.width=`${n}px`,M.style.height=`${n}px`,M.style.transform=`translate(${r}px, ${S}px)`,q.appendChild(M),M.offsetHeight,M.style.transition=""),M.innerText=s.value.toString(),M.className=`tile tile-${s.value}`;const G=s.value.toString().length;G>=4&&M.classList.add(`tile-digits-${G}`),s.isNew&&M.classList.add("tile-new"),s.isMerged&&M.classList.add("tile-merged"),M.style.width=`${n}px`,M.style.height=`${n}px`,M.style.transform=`translate(${r}px, ${S}px)`}),Oe.innerText=x.getScore().toString(),Ne.innerText=x.getBestScore().toString(),Be.innerText=x.getPlayerName(),x.isGameOver()?(Fe.innerText=x.getScore().toString(),$.classList.remove("hidden")):$.classList.add("hidden")}function ke(){return!$.classList.contains("hidden")||!_.classList.contains("hidden")}function A(f){x.isGameOver()||ke()||x.move(f)&&(W(),Ae())}function Ae(){const f=[1024,2048,4096,8192],a=x.getGrid(),n=x.getCelebratedTiles();for(const c of a)if(c&&f.includes(c.value)&&!n.has(c.value)){n.add(c.value),x.saveState(),Re();break}}function Re(){const a=Date.now()+3e3,n={startVelocity:30,spread:360,ticks:60,zIndex:0};function c(s,v){return Math.random()*(v-s)+s}const u=setInterval(function(){const s=a-Date.now();if(s<=0)return clearInterval(u);const v=50*(s/3e3);ee({...n,particleCount:v,origin:{x:c(.1,.3),y:Math.random()-.2}}),ee({...n,particleCount:v,origin:{x:c(.7,.9),y:Math.random()-.2}})},250)}window.resetGame=()=>{$.classList.add("hidden"),z.value=x.getPlayerName(),_.classList.remove("hidden"),z.focus()};te.addEventListener("click",()=>{const f=z.value.trim()||"Player";x.setPlayerName(f),_.classList.add("hidden"),x.init(!1),W()});z.addEventListener("keydown",f=>{f.key==="Enter"&&te.click()});document.addEventListener("keydown",f=>{document.activeElement!==z&&(f.key==="ArrowLeft"&&A("left"),f.key==="ArrowRight"&&A("right"),f.key==="ArrowUp"&&A("up"),f.key==="ArrowDown"&&A("down"),f.altKey&&f.key.toLowerCase()==="n"&&(f.preventDefault(),window.resetGame()))});let R,D;const re=(f,a)=>{if(R===null||D===null)return;const n=f-R,c=a-D,u=30;Math.abs(n)>Math.abs(c)?Math.abs(n)>u&&A(n>0?"right":"left"):Math.abs(c)>u&&A(c>0?"down":"up"),R=D=null};document.addEventListener("touchstart",f=>{R=f.touches[0].clientX,D=f.touches[0].clientY},{passive:!0});document.addEventListener("touchend",f=>re(f.changedTouches[0].clientX,f.changedTouches[0].clientY),{passive:!0});document.addEventListener("mousedown",f=>{R=f.clientX,D=f.clientY});document.addEventListener("mouseup",f=>re(f.clientX,f.clientY));window.addEventListener("resize",W);x.init();W();
